<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashflow Online | Edi√ß√£o Original</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS completo (mantido igual ao original) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2C3E50;
            --secondary: #3498DB;
            --success: #2ECC71;
            --danger: #E74C3C;
            --warning: #F39C12;
            --light: #ECF0F1;
            --dark: #2C3E50;
            --player1: #E74C3C;
            --player2: #3498DB;
            --player3: #2ECC71;
            --player4: #9B59B6;
            --player5: #F39C12;
            --player6: #1ABC9C;
            --protection: #27ae60;
        }

        body {
            background: linear-gradient(135deg, #1a2a3a, #2c3e50);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .setup-screen {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid var(--warning);
            max-width: 800px;
            margin: 20px auto;
        }

        .setup-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: bold;
            color: var(--warning);
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .player-names-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .board-table-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            border: 2px solid var(--secondary);
        }

        .board-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0 auto;
        }

        .board-table th {
            background: var(--secondary);
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
        }

        .board-table td {
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            vertical-align: middle;
            min-width: 120px;
            position: relative;
        }

        .board-table td:first-child {
            width: 40px;
            min-width: 40px;
        }

        .space-number {
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--warning);
            padding: 2px 4px;
            background: rgba(243, 156, 18, 0.2);
            border-radius: 4px;
            display: inline-block;
            width: 30px;
        }

        .space-type {
            font-size: 0.8rem;
            margin: 3px 0;
        }

        .space-action {
            font-size: 0.75rem;
            color: #bdc3c7;
        }

        .player-markers-cell {
            min-width: 180px;
        }

        .space-start { background: rgba(243, 156, 18, 0.15); border-left: 4px solid var(--warning); }
        .space-opportunity { background: rgba(52, 152, 219, 0.15); border-left: 4px solid var(--player2); }
        .space-payday { background: rgba(155, 89, 182, 0.15); border-left: 4px solid var(--player4); }
        .space-doodad { background: rgba(231, 76, 60, 0.25); border-left: 4px solid var(--player1); }
        .space-market { background: rgba(46, 204, 113, 0.15); border-left: 4px solid var(--success); }
        .space-baby { background: rgba(241, 196, 15, 0.15); border-left: 4px solid #F1C40F; }
        .space-downsized { background: rgba(230, 126, 34, 0.15); border-left: 4px solid #E67E22; }
        .space-charity { background: rgba(230, 126, 34, 0.15); border-left: 4px solid #E67E22; }

        .player-markers {
            display: flex;
            justify-content: center;
            gap: 3px;
            margin-top: 5px;
            flex-wrap: wrap;
        }

        .player-marker {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            border: 2px solid var(--secondary);
        }

        .dice-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .dice {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            user-select: none;
        }

        .dice.rolling {
            animation: roll 0.5s infinite;
        }

        @keyframes roll {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .button-success { background: var(--success); }
        .button-danger { background: var(--danger); }
        .button-warning { background: var(--warning); }
        .button-purple { background: #9b59b6; }
        .button-protection { background: var(--protection); }

        .card-display {
            background: white;
            color: var(--dark);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: none;
            border-top: 8px solid var(--secondary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .card-title {
            color: var(--secondary);
            font-size: 1.3rem;
            font-weight: bold;
        }

        .card-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .card-detail {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
        }

        .detail-label {
            font-size: 0.85rem;
            color: #666;
        }

        .detail-value {
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 5px;
        }

        .card-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .asset-selection-modal {
            max-height: 60vh;
            overflow-y: auto;
        }

        .asset-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .asset-info {
            flex: 1;
        }

        .sell-checkbox {
            margin-left: 15px;
        }

        .log-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--secondary);
        }

        .log-content {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
        }

        .log-entry {
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            color: var(--dark);
            border-radius: 15px;
            padding: 25px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .modal-title {
            color: var(--secondary);
            font-size: 1.4rem;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--danger);
        }

        .player-info-below-table {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid var(--warning);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .player-info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .info-label {
            font-size: 0.8rem;
            color: #bdc3c7;
            margin-bottom: 3px;
            text-align: center;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: bold;
            text-align: center;
        }

        .info-income { color: var(--success); }
        .info-expense { color: var(--danger); }
        .info-warning { color: var(--warning); }
        .info-protection { color: var(--protection); }

        .debt-indicator {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid var(--danger);
            border-radius: 20px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: var(--danger);
            grid-column: 1 / -1;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .board-table {
                font-size: 0.8rem;
            }
            
            .board-table th,
            .board-table td {
                padding: 6px;
            }
            
            .board-table td:first-child {
                width: 30px;
                min-width: 30px;
            }
            
            .space-number {
                width: 25px;
                font-size: 0.8rem;
            }
            
            .player-markers-cell {
                min-width: 120px;
            }
            
            .dice-container {
                gap: 10px;
            }
            
            .dice {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            .button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .player-info-below-table {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .debt-indicator {
                grid-column: 1;
            }
        }

        .color-1 { background: var(--player1); }
        .color-2 { background: var(--player2); }
        .color-3 { background: var(--player3); }
        .color-4 { background: var(--player4); }
        .color-5 { background: var(--player5); }
        .color-6 { background: var(--player6); }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse-warning {
            animation: pulse 1s infinite;
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            color: var(--warning);
            font-size: 1.1rem;
        }

        .fast-track-section {
            background: rgba(155, 89, 182, 0.3);
            border: 2px solid #9b59b6;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .fast-track-card {
            background: white;
            color: var(--dark);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 5px solid #9b59b6;
        }

        .fast-track-header {
            color: #9b59b6;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dream-achieved {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin: 5px 0;
        }

        .professions-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.85rem;
        }

        .professions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .profession-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 5px;
            border-left: 3px solid var(--warning);
        }

        .button-loan {
            background: #9b59b6;
        }

        .protection-badge {
            background: var(--protection);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- TELA DE CONFIGURA√á√ÉO -->
        <div id="setupScreen" class="setup-screen">
            <h2 style="color: var(--warning); text-align: center; margin-bottom: 20px;">
                <i class="fas fa-cogs"></i> CONFIGURA√á√ÉO DO JOGO
            </h2>
            
            <div class="setup-form">
                <div class="form-group">
                    <label><i class="fas fa-users"></i> N√öMERO DE JOGADORES (2-6)</label>
                    <select id="numPlayers">
                        <option value="2">2 Jogadores</option>
                        <option value="3">3 Jogadores</option>
                        <option value="4">4 Jogadores</option>
                        <option value="5">5 Jogadores</option>
                        <option value="6">6 Jogadores</option>
                    </select>
                </div>
                
                <div id="playerNamesContainer" class="player-names-container">
                    <!-- Nomes ser√£o gerados aqui -->
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="button button-warning" id="startGameBtn" style="padding: 15px 40px; font-size: 1.1rem;">
                        <i class="fas fa-play"></i> INICIAR JOGO
                    </button>
                </div>
            </div>
        </div>

        <!-- √ÅREA DO JOGO -->
        <div id="gameArea" style="display: none;">
            <header style="text-align: center; margin-bottom: 20px;">
                <h1 style="color: var(--warning); font-size: 2rem;">
                    <i class="fas fa-coins"></i> CASHFLOW ONLINE - EDI√á√ÉO ORIGINAL
                </h1>
                <p style="color: var(--light);">Fiel ao jogo de tabuleiro original</p>
            </header>

            <!-- INFORMA√á√ïES DO JOGO -->
            <div class="game-stats">
                <div class="stat-item">
                    <div>Rodada Atual</div>
                    <div class="stat-value" id="currentRound">1</div>
                </div>
                <div class="stat-item">
                    <div>Status</div>
                    <div class="stat-value" id="gameStatus">CORRIDA DOS RATOS</div>
                </div>
                <div class="stat-item">
                    <div>Jogadores Fast Track</div>
                    <div class="stat-value" id="fastTrackCount">0</div>
                </div>
            </div>

            <!-- TABELA DO TABULEIRO -->
            <div class="board-table-container">
                <h3 style="color: var(--warning); margin-bottom: 15px; text-align: center;">
                    <i class="fas fa-table"></i> TABULEIRO - CORRIDA DOS RATOS
                </h3>
                <table class="board-table" id="boardTable">
                    <!-- Gerado dinamicamente -->
                </table>
            </div>

            <!-- INFORMA√á√ïES DO JOGADOR ATUAL -->
            <div class="player-info-below-table" id="currentPlayerInfo">
                <!-- Informa√ß√µes ser√£o inseridas aqui -->
            </div>

            <!-- CONTROLES -->
            <div class="controls">
                <h3 style="color: var(--warning); margin-bottom: 15px; text-align: center;">
                    <i class="fas fa-gamepad"></i> CONTROLES
                </h3>
                
                <div class="dice-container">
                    <div class="dice" id="dice1">?</div>
                    <div class="dice" id="dice2" style="display: none;">?</div>
                </div>
                
                <div>
                    <button class="button button-warning" id="rollDiceBtn">
                        <i class="fas fa-dice"></i> ROLAR DADOS
                    </button>
                    
                    <button class="button" id="endTurnBtn" disabled>
                        <i class="fas fa-forward"></i> FINALIZAR TURNO
                    </button>
                    
                    <button class="button button-success" id="showAssetsBtn">
                        <i class="fas fa-chart-pie"></i> MEUS ATIVOS
                    </button>
                    
                    <button class="button button-loan" id="takeLoanBtn">
                        <i class="fas fa-university"></i> PEGAR EMPR√âSTIMO
                    </button>
                    
                    <button class="button button-danger" id="payLoansBtn" style="display: none;">
                        <i class="fas fa-money-check-alt"></i> QUITAR D√çVIDAS
                    </button>
                    
                    <button class="button button-protection" id="useProtectionBtn" style="display: none;">
                        <i class="fas fa-shield-alt"></i> USAR PROTE√á√ÉO
                    </button>
                    
                    <button class="button button-purple" id="newGameBtn">
                        <i class="fas fa-redo"></i> NOVO JOGO
                    </button>
                </div>
                
                <div id="winnerMessage" style="margin-top: 15px;"></div>
            </div>

            <!-- √ÅREA DE CARTAS -->
            <div class="card-display" id="cardDisplay">
                <div class="card-header">
                    <div class="card-title" id="cardTitle">OPORTUNIDADE</div>
                    <div id="cardTypeTag" style="background: #3498db; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: bold;">
                        PEQUENA OPORTUNIDADE
                    </div>
                </div>
                
                <div id="cardDescription" style="margin-bottom: 15px;"></div>
                
                <div class="card-details" id="cardDetails">
                    <!-- Detalhes aqui -->
                </div>
                
                <div class="card-actions" id="cardActions">
                    <!-- Bot√µes aqui -->
                </div>
            </div>

            <!-- LOG DO JOGO -->
            <div class="log-section">
                <h3 style="color: var(--warning); margin-bottom: 15px; text-align: center;">
                    <i class="fas fa-history"></i> HIST√ìRICO DO JOGO
                </h3>
                <div class="log-content" id="gameLog">
                    <div class="log-entry">Jogo iniciado!</div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <button class="button" onclick="clearLog()" style="padding: 8px 15px;">
                        <i class="fas fa-trash"></i> Limpar Hist√≥rico
                    </button>
                </div>
            </div>

            <!-- INFORMA√á√ïES DAS PROFISS√ïES -->
            <div class="professions-info" id="professionsInfo">
                <h4 style="color: var(--warning); margin-bottom: 10px;">
                    <i class="fas fa-user-tie"></i> PROFISS√ïES DO JOGO
                </h4>
                <div class="professions-grid" id="professionsGrid">
                    <!-- Profiss√µes ser√£o inseridas aqui -->
                </div>
            </div>

            <!-- FAST TRACK SECTION -->
            <div class="fast-track-section" id="fastTrackSection">
                <h3 style="color: #9b59b6; margin-bottom: 15px; text-align: center;">
                    <i class="fas fa-bolt"></i> VIA R√ÅPIDA (FAST TRACK)
                </h3>
                <div id="fastTrackContent">
                    <!-- Conte√∫do da via r√°pida -->
                </div>
            </div>
        </div>

        <!-- MODAIS -->
        <div class="modal" id="assetsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="assetsTitle">MEUS ATIVOS</div>
                    <button class="close-modal" onclick="closeModal('assetsModal')">&times;</button>
                </div>
                <div id="assetsContent"></div>
            </div>
        </div>

        <div class="modal" id="sellAssetsModal">
            <div class="modal-content asset-selection-modal">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-home"></i> VENDER IM√ìVEIS</div>
                    <button class="close-modal" onclick="closeModal('sellAssetsModal')">&times;</button>
                </div>
                <div id="sellAssetsContent"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="button button-success" onclick="confirmSellAssets()">
                        <i class="fas fa-check"></i> VENDER SELECIONADOS
                    </button>
                    <button class="button" onclick="closeModal('sellAssetsModal')">
                        <i class="fas fa-times"></i> CANCELAR
                    </button>
                </div>
            </div>
        </div>

        <div class="modal" id="sellStocksModal">
            <div class="modal-content asset-selection-modal">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-chart-line"></i> VENDER A√á√ïES</div>
                    <button class="close-modal" onclick="closeModal('sellStocksModal')">&times;</button>
                </div>
                <div id="sellStocksContent"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="button button-success" onclick="confirmSellStocks()">
                        <i class="fas fa-check"></i> VENDER SELECIONADOS
                    </button>
                    <button class="button" onclick="closeModal('sellStocksModal')">
                        <i class="fas fa-times"></i> CANCELAR
                    </button>
                </div>
            </div>
        </div>

        <div class="modal" id="loanModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-university"></i> PEGAR EMPR√âSTIMO</div>
                    <button class="close-modal" onclick="closeModal('loanModal')">&times;</button>
                </div>
                <div id="loanContent"></div>
            </div>
        </div>

        <!-- MODAL PARA QUITAR D√çVIDAS -->
        <div class="modal" id="payLoansModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-money-check-alt"></i> QUITAR D√çVIDAS</div>
                    <button class="close-modal" onclick="closeModal('payLoansModal')">&times;</button>
                </div>
                <div id="payLoansContent"></div>
            </div>
        </div>

    </div>

    <script>
        // =========== CONFIGURA√á√ÉO DO JOGO ===========
        const gameState = {
            currentPlayer: 1,
            gameActive: true,
            diceValue: 0,
            currentCard: null,
            totalPlayers: 2,
            players: {},
            spaces: [],
            dice3Enabled: false,
            charityPlayer: null,
            charityRoundsLeft: 0,
            currentRound: 1,
            totalLaps: 0,
            marketEvent: null,
            availableProfessions: [],
            playerDreams: {},
            nextDoodadProtected: false,
            protectedPlayer: null
        };

        // =========== PROFISS√ïES DO JOGO ORIGINAL ===========
        const allProfessions = [
            {
                name: "Zelador (Janitor)",
                salary: 1600,
                perChildCost: 70,
                taxes: 280,
                mortgage: 300,
                carPayment: 100,
                creditCard: 60,
                otherExpenses: 190,
                studentLoan: 0
            },
            {
                name: "Caminhoneiro",
                salary: 2500,
                perChildCost: 140,
                taxes: 460,
                mortgage: 400,
                carPayment: 140,
                creditCard: 90,
                otherExpenses: 300,
                studentLoan: 0
            },
            {
                name: "Secret√°ria",
                salary: 2500,
                perChildCost: 120,
                taxes: 460,
                mortgage: 400,
                carPayment: 120,
                creditCard: 90,
                otherExpenses: 300,
                studentLoan: 0
            },
            {
                name: "Policial",
                salary: 3000,
                perChildCost: 160,
                taxes: 580,
                mortgage: 500,
                carPayment: 160,
                creditCard: 120,
                otherExpenses: 350,
                studentLoan: 0
            },
            {
                name: "Professor",
                salary: 3300,
                perChildCost: 110,
                taxes: 630,
                mortgage: 500,
                carPayment: 150,
                creditCard: 120,
                otherExpenses: 360,
                studentLoan: 180
            },
            {
                name: "Mec√¢nico",
                salary: 3300,
                perChildCost: 140,
                taxes: 630,
                mortgage: 500,
                carPayment: 200,
                creditCard: 120,
                otherExpenses: 360,
                studentLoan: 0
            },
            {
                name: "Enfermeiro",
                salary: 3600,
                perChildCost: 170,
                taxes: 700,
                mortgage: 600,
                carPayment: 200,
                creditCard: 140,
                otherExpenses: 380,
                studentLoan: 120
            },
            {
                name: "Gerente",
                salary: 4600,
                perChildCost: 240,
                taxes: 910,
                mortgage: 900,
                carPayment: 300,
                creditCard: 220,
                otherExpenses: 500,
                studentLoan: 0
            },
            {
                name: "Engenheiro",
                salary: 4900,
                perChildCost: 250,
                taxes: 1050,
                mortgage: 750,
                carPayment: 300,
                creditCard: 220,
                otherExpenses: 550,
                studentLoan: 250
            },
            {
                name: "Advogado",
                salary: 7500,
                perChildCost: 380,
                taxes: 1830,
                mortgage: 1100,
                carPayment: 300,
                creditCard: 220,
                otherExpenses: 630,
                studentLoan: 400
            },
            {
                name: "Piloto",
                salary: 9500,
                perChildCost: 380,
                taxes: 2350,
                mortgage: 1300,
                carPayment: 400,
                creditCard: 300,
                otherExpenses: 750,
                studentLoan: 0
            },
            {
                name: "M√©dico",
                salary: 13000,
                perChildCost: 640,
                taxes: 3400,
                mortgage: 1900,
                carPayment: 600,
                creditCard: 400,
                otherExpenses: 1000,
                studentLoan: 1000
            }
        ];

        // =========== SONHOS ===========
        const allDreams = [
            "Iate de Luxo",
            "Mans√£o na Praia",
            "Ferrari Vermelha",
            "Viagem ao Espa√ßo",
            "Ilha Particular",
            "Cole√ß√£o de Arte",
            "Helic√≥ptero Particular",
            "Time de Futebol",
            "Castelo na Europa",
            "Cruzeiro ao Redor do Mundo",
            "Fazenda de Cavalos",
            "Observat√≥rio Astron√¥mico"
        ];

        // =========== NOVAS CARTAS PEQUENAS OPORTUNIDADES (COM CUSTO) ===========
        const smallDealCards = [
            // A√ß√µes Brasileiras com Dividendos
            { name: "ITUB4 ‚Äì Banco Ita√∫", type: "a√ß√µes", cost: 2500, cashflow: 120, description: "A√ß√£o brasileira com bons dividendos." },
            { name: "BBAS3 ‚Äì Banco do Brasil", type: "a√ß√µes", cost: 2800, cashflow: 130, description: "Banco estatal com dividendos consistentes." },
            { name: "TAEE11 ‚Äì Transmissora", type: "a√ß√µes", cost: 3000, cashflow: 150, description: "Empresa de transmiss√£o de energia." },
            { name: "TRPL4 ‚Äì Transmissora Paulista", type: "a√ß√µes", cost: 3200, cashflow: 160, description: "Concession√°ria de energia est√°vel." },
            { name: "EGIE3 ‚Äì Energia", type: "a√ß√µes", cost: 3500, cashflow: 170, description: "Geradora de energia renov√°vel." },
            { name: "CPLE6 ‚Äì Copel", type: "a√ß√µes", cost: 3800, cashflow: 180, description: "Companhia Paranaense de Energia." },
            { name: "BBSE3 ‚Äì Seguros", type: "a√ß√µes", cost: 4000, cashflow: 200, description: "Seguradora com bons retornos." },
            { name: "VIVT3 ‚Äì Telecomunica√ß√µes", type: "a√ß√µes", cost: 4500, cashflow: 220, description: "Operadora de telecomunica√ß√µes." },
            { name: "CMIG4 ‚Äì Energia MG", type: "a√ß√µes", cost: 5000, cashflow: 240, description: "Companhia Energ√©tica de Minas Gerais." },
            { name: "SANB11 ‚Äì Santander Brasil", type: "a√ß√µes", cost: 5500, cashflow: 260, description: "Banco com forte presen√ßa no Brasil." },
            
            // Renda Passiva Real
            { name: "Aluguel de quarto", type: "renda", cost: 4000, cashflow: 250, description: "Quarto alugado em local movimentado." },
            { name: "Contrato de estacionamento", type: "renda", cost: 4500, cashflow: 280, description: "Vaga de estacionamento alugada." },
            { name: "Aluguel de garagem", type: "renda", cost: 5000, cashflow: 300, description: "Garagem para ve√≠culos." },
            { name: "M√°quina vending", type: "renda", cost: 5500, cashflow: 320, description: "M√°quina de venda autom√°tica." },
            { name: "Contrato de publicidade", type: "renda", cost: 6000, cashflow: 350, description: "Espa√ßo publicit√°rio alugado." },
            { name: "Ponto de aluguel simples", type: "renda", cost: 6500, cashflow: 380, description: "Pequeno ponto comercial." },
            { name: "Aluguel compartilhado", type: "renda", cost: 7000, cashflow: 400, description: "Espa√ßo compartilhado para coworking." },
            { name: "Contrato recorrente local", type: "renda", cost: 7500, cashflow: 430, description: "Contrato com empresa local." },
            { name: "Pequeno im√≥vel alugado", type: "renda", cost: 8000, cashflow: 460, description: "Im√≥vel pequeno para aluguel." },
            { name: "Contrato corporativo leve", type: "renda", cost: 8500, cashflow: 500, description: "Contrato com pequena empresa." },
            
            // Ativos Operacionais Leves
            { name: "Canal digital monetizado", type: "digital", cost: 6000, cashflow: 350, description: "Canal online com receita recorrente." },
            { name: "Infoproduto simples", type: "digital", cost: 6500, cashflow: 380, description: "Produto digital com vendas constantes." },
            { name: "Licenciamento de marca", type: "digital", cost: 7000, cashflow: 420, description: "Licenciamento de marca local." },
            { name: "Servi√ßo automatizado", type: "digital", cost: 7500, cashflow: 450, description: "Sistema automatizado com assinaturas." },
            { name: "Plataforma simples", type: "digital", cost: 8000, cashflow: 480, description: "Plataforma digital com receita mensal." }
        ];

        // =========== BIG DEALS ===========
        const bigDealCards = [
            {
                name: "Apartamento de 2 Quartos",
                type: "im√≥vel",
                description: "Apartamento para aluguel em √°rea urbana.",
                cost: 65000,
                downPayment: 13000,
                mortgage: 52000,
                cashflow: 90
            },
            {
                name: "Casa de 3 Quartos",
                type: "im√≥vel",
                description: "Casa em bairro nobre.",
                cost: 135000,
                downPayment: 27000,
                mortgage: 108000,
                cashflow: 500
            },
            {
                name: "Franquia de Fast Food",
                type: "neg√≥cio",
                description: "Restaurante de rede.",
                cost: 250000,
                downPayment: 50000,
                mortgage: 200000,
                cashflow: 2000
            },
            {
                name: "Pr√©dio de 24 Apartamentos",
                type: "im√≥vel",
                description: "Edif√≠cio residencial completo.",
                cost: 1200000,
                downPayment: 150000,
                mortgage: 1050000,
                cashflow: 3000,
                requires: "1 volta completa"
            },
            {
                name: "Empresa de Software",
                type: "neg√≥cio",
                description: "Startup de tecnologia.",
                cost: 500000,
                downPayment: 100000,
                mortgage: 400000,
                cashflow: 3000,
                requires: "1 volta completa OU renda passiva R$ 2.000/m√™s"
            }
        ];

        // =========== DOODADS ESCALONADOS ===========
        const doodadCardsByLaps = {
            "voltas_1_3": [
                { name: "Celular quebrado", description: "Troca de tela e bateria.", cost: 500 },
                { name: "Consulta m√©dica b√°sica", description: "Consulta com cl√≠nico geral.", cost: 300 },
                { name: "Livros did√°ticos", description: "Material escolar para filhos.", cost: 400 },
                { name: "Manuten√ß√£o preventiva", description: "Manuten√ß√£o b√°sica do carro.", cost: 800 },
                { name: "Presente de anivers√°rio", description: "Presente para familiar.", cost: 200 },
                { name: "Curso online b√°sico", description: "Curso de qualifica√ß√£o.", cost: 600 },
                { name: "Roupas novas", description: "Roupas para trabalho.", cost: 700 },
                { name: "Jantar especial", description: "Jantar em restaurante.", cost: 250 }
            ],
            "voltas_4_6": [
                { name: "Reparo no carro", description: "Troca de pe√ßas importantes.", cost: 3000 },
                { name: "Curso presencial", description: "Curso profissionalizante.", cost: 2000 },
                { name: "M√≥veis novos", description: "M√≥veis para casa.", cost: 4000 },
                { name: "Viagem de fim de semana", description: "Viagem para descanso.", cost: 3500 },
                { name: "Eletrodom√©stico", description: "Geladeira ou fog√£o novo.", cost: 2500 },
                { name: "Tratamento odontol√≥gico", description: "Tratamento dent√°rio.", cost: 5000 },
                { name: "Computador novo", description: "Computador para trabalho.", cost: 4000 },
                { name: "Reforma pequena", description: "Pequena reforma em casa.", cost: 6000 }
            ],
            "voltas_7_9": [
                { name: "Cirurgia m√©dica", description: "Cirurgia eletiva.", cost: 15000 },
                { name: "Reforma completa", description: "Reforma da casa.", cost: 20000 },
                { name: "Carro usado", description: "Compra de carro seminovo.", cost: 18000 },
                { name: "Problema judicial", description: "Custas advocat√≠cias.", cost: 12000 },
                { name: "Emerg√™ncia familiar", description: "Ajuda para familiar.", cost: 10000 },
                { name: "F√©rias em fam√≠lia", description: "F√©rias para fam√≠lia toda.", cost: 22000 },
                { name: "Tratamento especializado", description: "Tratamento m√©dico.", cost: 25000 }
            ],
            "voltas_10_mais": [
                { name: "Carro novo", description: "Carro zero km b√°sico.", cost: 30000 },
                { name: "Crise financeira", description: "Perda de investimento.", cost: 35000 },
                { name: "Problema de sa√∫de grave", description: "Tratamento hospitalar.", cost: 40000 },
                { name: "D√≠vida antiga", description: "D√≠vida que apareceu.", cost: 25000 },
                { name: "Preju√≠zo no neg√≥cio", description: "Preju√≠zo em investimento.", cost: 45000 },
                { name: "Emerg√™ncia grave", description: "Emerg√™ncia familiar grave.", cost: 50000 }
            ]
        };

        // =========== CARTAS DE MERCADO ===========
        const marketCards = [
            {
                name: "IM√ìVEIS VALORIZARAM!",
                type: "alta",
                assetType: "im√≥vel",
                description: "Grande demanda por im√≥veis!",
                modifier: 1.5
            },
            {
                name: "A√á√ïES EM ALTA!",
                type: "alta",
                assetType: "a√ß√µes",
                description: "Mercado de a√ß√µes em alta!",
                modifier: 2.0
            },
            {
                name: "CRISE IMOBILI√ÅRIA",
                type: "baixa",
                assetType: "im√≥vel",
                description: "Mercado imobili√°rio em crise.",
                modifier: 0.7
            },
            {
                name: "BOLSA EM QUEDA",
                type: "baixa",
                assetType: "a√ß√µes",
                description: "Crise no mercado de a√ß√µes.",
                modifier: 0.5
            }
        ];

        // =========== FAST TRACK CARDS ===========
        const fastTrackCards = [
            {
                id: "floresta",
                nome: "Compre uma Floresta",
                descricao: "500 hectares de floresta.",
                tipo: "gasto",
                custo: 125000
            },
            {
                id: "carnaval",
                nome: "Festival de Carnaval",
                descricao: "Patrocine um bloco.",
                tipo: "gasto",
                custo: 62500
            },
            {
                id: "franquia_frango",
                nome: "Franquia de Frango",
                descricao: "Rede de fast-food.",
                tipo: "investimento",
                entrada: 150000,
                ccr: 40
            },
            {
                id: "auditoria",
                nome: "Auditoria Fiscal",
                descricao: "Multa por irregularidades.",
                tipo: "penalidade"
            }
        ];

        // =========== INICIALIZA√á√ÉO ===========
        function initializeGame() {
            setupPlayerNames();
            
            document.getElementById('numPlayers').addEventListener('change', setupPlayerNames);
            document.getElementById('startGameBtn').addEventListener('click', startGame);
            document.getElementById('rollDiceBtn').addEventListener('click', rollDice);
            document.getElementById('endTurnBtn').addEventListener('click', endTurn);
            document.getElementById('showAssetsBtn').addEventListener('click', showAssets);
            document.getElementById('takeLoanBtn').addEventListener('click', showLoanModal);
            document.getElementById('payLoansBtn').addEventListener('click', showPayLoansModal);
            document.getElementById('useProtectionBtn').addEventListener('click', useProtection);
            document.getElementById('newGameBtn').addEventListener('click', () => location.reload());
            
            showProfessionsInfo();
        }

        function setupPlayerNames() {
            const numPlayers = parseInt(document.getElementById('numPlayers').value);
            const container = document.getElementById('playerNamesContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= numPlayers; i++) {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label>Jogador ${i}:</label>
                    <input type="text" id="playerName${i}" value="Jogador ${i}" placeholder="Nome do jogador">
                `;
                container.appendChild(div);
            }
        }

        function getRandomProfession() {
            if (gameState.availableProfessions.length === 0) {
                gameState.availableProfessions = [...allProfessions];
            }
            
            const randomIndex = Math.floor(Math.random() * gameState.availableProfessions.length);
            const profession = gameState.availableProfessions[randomIndex];
            gameState.availableProfessions.splice(randomIndex, 1);
            
            return profession;
        }

        function getRandomDreamForPlayer(playerId) {
            if (!gameState.playerDreams[playerId]) {
                let availableDreams = allDreams.filter(dream => 
                    !Object.values(gameState.playerDreams).includes(dream)
                );
                
                if (availableDreams.length === 0) {
                    gameState.playerDreams = {};
                    availableDreams = [...allDreams];
                }
                
                const randomDream = availableDreams[Math.floor(Math.random() * availableDreams.length)];
                gameState.playerDreams[playerId] = randomDream;
            }
            
            return gameState.playerDreams[playerId];
        }

        function startGame() {
            const numPlayers = parseInt(document.getElementById('numPlayers').value);
            gameState.totalPlayers = numPlayers;
            gameState.players = {};
            gameState.currentRound = 1;
            gameState.availableProfessions = [...allProfessions];
            gameState.playerDreams = {};
            
            for (let i = 1; i <= numPlayers; i++) {
                const name = document.getElementById(`playerName${i}`).value || `Jogador ${i}`;
                const prof = getRandomProfession();
                const dream = getRandomDreamForPlayer(i);
                
                const totalExpenses = prof.taxes + prof.mortgage + prof.carPayment + 
                                    prof.creditCard + prof.otherExpenses + prof.studentLoan;
                
                const initialCash = totalExpenses * 2;
                
                gameState.players[i] = {
                    id: i,
                    name: name,
                    profession: prof.name,
                    salary: prof.salary,
                    initialCash: initialCash,
                    cash: initialCash,
                    passiveIncome: 0,
                    position: 0,
                    inRatRace: true,
                    children: 0,
                    maxChildren: 3,
                    perChildCost: prof.perChildCost,
                    expenses: totalExpenses,
                    cashflow: prof.salary - totalExpenses,
                    assets: {
                        stocks: [],
                        realEstate: [],
                        businesses: [],
                        bonds: [],
                        protection: null
                    },
                    loans: [],
                    hasCharityBonus: false,
                    lapsCompleted: 0,
                    dreams: [],
                    assignedDream: dream,
                    isDownsized: false,
                    downsizedRounds: 0
                };
            }
            
            createBoard();
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            
            updateBoard();
            updateCurrentPlayerInfo();
            updateGameStats();
            updateProtectionButton();
            updatePayLoansButton();
            
            addLog("üéÆ JOGO INICIADO!");
            
            for (let i = 1; i <= numPlayers; i++) {
                const player = gameState.players[i];
                addLog(`üë§ ${player.name} √© ${player.profession}`);
            }
            addLog(`üé≤ Vez de: ${gameState.players[1].name}`);
        }

        // =========== TABULEIRO ===========
        function createBoard() {
            gameState.spaces = [];
            
            const spaceTypes = [
                'start', 'opportunity', 'doodad', 'opportunity', 'market',
                'opportunity', 'payday', 'opportunity', 'downsized', 'opportunity',
                'doodad', 'opportunity', 'market', 'opportunity', 'payday',
                'opportunity', 'baby', 'opportunity', 'doodad', 'opportunity',
                'charity', 'opportunity', 'payday', 'opportunity', 'market'
            ];
            
            const spaceNames = [
                'IN√çCIO', 'OPORTUNIDADE', 'DOODADS', 'OPORTUNIDADE', 'MERCADO',
                'OPORTUNIDADE', 'DIA DE PAGAMENTO', 'OPORTUNIDADE', 'DEMISS√ÉO', 'OPORTUNIDADE',
                'DOODADS', 'OPORTUNIDADE', 'MERCADO', 'OPORTUNIDADE', 'DIA DE PAGAMENTO',
                'OPORTUNIDADE', 'BEB√ä', 'OPORTUNIDADE', 'DOODADS', 'OPORTUNIDADE',
                'CARIDADE', 'OPORTUNIDADE', 'DIA DE PAGAMENTO', 'OPORTUNIDADE', 'MERCADO'
            ];
            
            const spaceActions = [
                'Comece aqui!', 'Compre Small Deal ou Big Deal', 'Gasto obrigat√≥rio!', 'Compre Small Deal ou Big Deal', 'Venda ou compre ativos',
                'Compre Small Deal ou Big Deal', 'Receba sal√°rio + renda passiva', 'Compre Small Deal ou Big Deal', 'Pague 1 m√™s de despesas', 'Compre Small Deal ou Big Deal',
                'Gasto obrigat√≥rio!', 'Compre Small Deal ou Big Deal', 'Venda ou compre ativos', 'Compre Small Deal ou Big Deal', 'Receba sal√°rio + renda passiva',
                'Compre Small Deal ou Big Deal', 'Despesas aumentam', 'Compre Small Deal ou Big Deal', 'Gasto obrigat√≥rio!', 'Compre Small Deal ou Big Deal',
                'Doa√ß√£o 10% do sal√°rio', 'Compre Small Deal ou Big Deal', 'Receba sal√°rio + renda passiva', 'Compre Small Deal ou Big Deal', 'Venda ou compre ativos'
            ];
            
            for (let i = 0; i < 25; i++) {
                gameState.spaces.push({
                    num: i + 1,
                    type: spaceTypes[i],
                    name: spaceNames[i],
                    action: spaceActions[i]
                });
            }
            
            const table = document.getElementById('boardTable');
            let html = `
                <thead>
                    <tr>
                        <th>ESPA√áO</th>
                        <th>TIPO</th>
                        <th>A√á√ÉO</th>
                        <th>JOGADORES</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            for (let i = 0; i < 25; i++) {
                const space = gameState.spaces[i];
                html += `
                    <tr class="space-${space.type}">
                        <td><span class="space-number">${space.num}</span></td>
                        <td><span class="space-type">${space.name}</span></td>
                        <td><span class="space-action">${space.action}</span></td>
                        <td id="spaceMarkers${i}" class="player-markers-cell">
                            <div class="player-markers" id="markers${i}"></div>
                        </td>
                    </tr>
                `;
            }
            
            html += '</tbody>';
            table.innerHTML = html;
        }

        function updateBoard() {
            for (let i = 0; i < 25; i++) {
                const markersDiv = document.getElementById(`markers${i}`);
                if (markersDiv) markersDiv.innerHTML = '';
            }
            
            for (let playerId = 1; playerId <= gameState.totalPlayers; playerId++) {
                const player = gameState.players[playerId];
                
                if (!player.inRatRace) continue;
                
                const markersDiv = document.getElementById(`markers${player.position}`);
                
                if (markersDiv) {
                    const marker = document.createElement('div');
                    marker.className = `player-marker color-${playerId}`;
                    marker.textContent = playerId;
                    marker.title = player.name;
                    markersDiv.appendChild(marker);
                }
            }
            
            updateFastTrackSection();
        }

        function showProfessionsInfo() {
            const container = document.getElementById('professionsGrid');
            let html = '';
            
            allProfessions.forEach(prof => {
                const totalExpenses = prof.taxes + prof.mortgage + prof.carPayment + 
                                    prof.creditCard + prof.otherExpenses + prof.studentLoan;
                const initialCash = totalExpenses * 2;
                const initialCashflow = prof.salary - totalExpenses;
                
                html += `
                    <div class="profession-item">
                        <strong>${prof.name}</strong><br>
                        <small>Sal√°rio: R$ ${prof.salary.toLocaleString()}</small><br>
                        <small>Inicial: R$ ${initialCash.toLocaleString()}</small><br>
                        <small>Fluxo: R$ ${initialCashflow.toLocaleString()}/m√™s</small>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateFastTrackSection() {
            const section = document.getElementById('fastTrackSection');
            const content = document.getElementById('fastTrackContent');
            
            let fastTrackPlayers = [];
            for (let playerId = 1; playerId <= gameState.totalPlayers; playerId++) {
                if (!gameState.players[playerId].inRatRace) {
                    fastTrackPlayers.push(gameState.players[playerId]);
                }
            }
            
            if (fastTrackPlayers.length > 0) {
                section.style.display = 'block';
                
                let html = '';
                fastTrackPlayers.forEach(player => {
                    html += `
                        <div class="fast-track-card">
                            <div class="fast-track-header">
                                <span>${player.name}</span>
                                <span style="color: #2ecc71;">R$ ${player.passiveIncome.toLocaleString()}/m√™s</span>
                            </div>
                            <p>Saldo: R$ ${player.cash.toLocaleString()}</p>
                            <p><strong>Sonho:</strong> ${player.assignedDream}</p>
                        </div>
                    `;
                });
                
                content.innerHTML = html;
            } else {
                section.style.display = 'none';
            }
            
            document.getElementById('fastTrackCount').textContent = fastTrackPlayers.length;
        }

        function updateGameStats() {
            document.getElementById('currentRound').textContent = gameState.currentRound;
            
            let fastTrackCount = 0;
            for (let playerId = 1; playerId <= gameState.totalPlayers; playerId++) {
                if (!gameState.players[playerId].inRatRace) {
                    fastTrackCount++;
                }
            }
            
            document.getElementById('fastTrackCount').textContent = fastTrackCount;
            
            if (fastTrackCount === gameState.totalPlayers) {
                document.getElementById('gameStatus').textContent = "TODOS NO FAST TRACK";
                document.getElementById('gameStatus').style.color = "#9b59b6";
            } else if (fastTrackCount > 0) {
                document.getElementById('gameStatus').textContent = "FAST TRACK ATIVO";
                document.getElementById('gameStatus').style.color = "#9b59b6";
            } else {
                document.getElementById('gameStatus').textContent = "CORRIDA DOS RATOS";
                document.getElementById('gameStatus').style.color = "#f39c12";
            }
        }

        function updateCurrentPlayerInfo() {
            const player = gameState.players[gameState.currentPlayer];
            const infoBar = document.getElementById('currentPlayerInfo');
            
            const childExpenses = player.children * player.perChildCost;
            const totalExpenses = player.expenses + childExpenses;
            
            let totalLoans = 0;
            let totalLoanPayments = 0;
            player.loans.forEach(loan => {
                totalLoans += loan.amount;
                totalLoanPayments += loan.monthlyPayment;
            });
            
            const totalIncome = player.salary + player.passiveIncome;
            const netIncome = Math.max(totalIncome - totalExpenses - totalLoanPayments, 0);
            
            let html = `
                <div class="player-info-item">
                    <div class="info-label">JOGADOR ATUAL</div>
                    <div class="info-value" style="color: var(--player${player.id})">
                        ${player.name}
                    </div>
                </div>
                
                <div class="player-info-item">
                    <div class="info-label">DINHEIRO</div>
                    <div class="info-value info-income">R$ ${player.cash.toLocaleString()}</div>
                </div>
                
                <div class="player-info-item">
                    <div class="info-label">RENDA PASSIVA</div>
                    <div class="info-value info-income">R$ ${player.passiveIncome.toLocaleString()}/m√™s</div>
                </div>
                
                <div class="player-info-item">
                    <div class="info-label">DESPESAS TOTAIS</div>
                    <div class="info-value info-expense">R$ ${totalExpenses.toLocaleString()}/m√™s</div>
                </div>
                
                <div class="player-info-item">
                    <div class="info-label">FLUXO DE CAIXA</div>
                    <div class="info-value" style="color: ${netIncome >= 0 ? '#2ecc71' : '#e74c3c'}">
                        R$ ${netIncome.toLocaleString()}/m√™s
                    </div>
                </div>
            `;
            
            if (player.children > 0) {
                html += `
                    <div class="player-info-item">
                        <div class="info-label">FILHOS</div>
                        <div class="info-value">${player.children}</div>
                    </div>
                `;
            }
            
            if (totalLoans > 0) {
                html += `
                    <div class="player-info-item">
                        <div class="info-label">EMPR√âSTIMOS</div>
                        <div class="info-value info-warning">R$ ${totalLoans.toLocaleString()}</div>
                    </div>
                `;
            }
            
            if (player.assets.protection) {
                html += `
                    <div class="player-info-item">
                        <div class="info-label">PROTE√á√ÉO</div>
                        <div class="info-value info-protection">
                            <i class="fas fa-shield-alt"></i> ATIVA
                        </div>
                    </div>
                `;
            }
            
            if (player.isDownsized) {
                html += `
                    <div class="player-info-item">
                        <div class="info-value info-warning">
                            <i class="fas fa-exclamation-triangle"></i> DEMITIDO
                        </div>
                    </div>
                `;
            }
            
            infoBar.innerHTML = html;
        }

        function updateProtectionButton() {
            const player = gameState.players[gameState.currentPlayer];
            const protectionBtn = document.getElementById('useProtectionBtn');
            
            if (player.assets.protection) {
                protectionBtn.style.display = 'inline-flex';
            } else {
                protectionBtn.style.display = 'none';
            }
        }

        function updatePayLoansButton() {
            const player = gameState.players[gameState.currentPlayer];
            const payLoansBtn = document.getElementById('payLoansBtn');
            
            if (player.loans.length > 0) {
                payLoansBtn.style.display = 'inline-flex';
            } else {
                payLoansBtn.style.display = 'none';
            }
        }

        // =========== PROTE√á√ÉO ===========
        function useProtection() {
            const player = gameState.players[gameState.currentPlayer];
            
            if (!player.assets.protection) {
                alert("Voc√™ n√£o possui prote√ß√£o!");
                return;
            }
            
            gameState.nextDoodadProtected = true;
            gameState.protectedPlayer = player.id;
            player.assets.protection = null;
            
            addLog(`üõ°Ô∏è ${player.name} ativou prote√ß√£o!`);
            
            updateProtectionButton();
            updateCurrentPlayerInfo();
        }

        // =========== EMPR√âSTIMOS ===========
        function showLoanModal() {
            const player = gameState.players[gameState.currentPlayer];
            
            let html = `
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--dark); margin-bottom: 10px;">Solicitar Empr√©stimo</h3>
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                            <span style="color: #666;">Saldo:</span>
                            <span style="font-weight: bold;">R$ ${player.cash.toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                            <span style="color: #666;">Juros:</span>
                            <span style="font-weight: bold; color: #e74c3c;">10% ao m√™s</span>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: var(--dark); margin-bottom: 15px;">Valores Dispon√≠veis:</h3>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
            `;
            
            const loanAmounts = [1000, 5000, 10000, 20000, 50000];
            
            loanAmounts.forEach(amount => {
                const monthlyPayment = amount * 0.1;
                html += `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; cursor: pointer;" 
                         onclick="takeLoan(${amount})">
                        <div style="font-weight: bold; font-size: 1.2rem; color: var(--dark);">
                            R$ ${amount.toLocaleString()}
                        </div>
                        <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">
                            Pagamento: R$ ${monthlyPayment.toLocaleString()}/m√™s
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
            `;
            
            document.getElementById('loanContent').innerHTML = html;
            document.getElementById('loanModal').style.display = 'flex';
        }

        function takeLoan(amount) {
            const player = gameState.players[gameState.currentPlayer];
            const monthlyPayment = amount * 0.1;
            
            player.loans.push({
                amount: amount,
                monthlyPayment: monthlyPayment
            });
            
            player.cash += amount;
            player.expenses += monthlyPayment;
            
            addLog(`üè¶ ${player.name} pegou empr√©stimo de R$ ${amount.toLocaleString()}`);
            
            closeModal('loanModal');
            updateCurrentPlayerInfo();
            updatePayLoansButton();
        }

        function showPayLoansModal() {
            const player = gameState.players[gameState.currentPlayer];
            
            if (player.loans.length === 0) {
                alert("Voc√™ n√£o tem d√≠vidas!");
                return;
            }
            
            let html = `
                <h3 style="color: var(--dark); margin-bottom: 15px;">Suas D√≠vidas</h3>
                <p style="margin-bottom: 15px; color: #666;">Saldo: <strong>R$ ${player.cash.toLocaleString()}</strong></p>
                <div style="max-height: 300px; overflow-y: auto;">
            `;
            
            player.loans.forEach((loan, index) => {
                html += `
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Empr√©stimo #${index + 1}</strong><br>
                                <small>Valor: R$ ${loan.amount.toLocaleString()}</small><br>
                                <small>Pagamento: R$ ${loan.monthlyPayment.toLocaleString()}/m√™s</small>
                            </div>
                            <button class="button ${player.cash >= loan.amount ? 'button-success' : 'button-danger'}" 
                                    onclick="payOffLoan(${index})" 
                                    ${player.cash < loan.amount ? 'disabled' : ''}>
                                Quitar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="button" onclick="closeModal('payLoansModal')">
                        <i class="fas fa-times"></i> FECHAR
                    </button>
                </div>
            `;
            
            document.getElementById('payLoansContent').innerHTML = html;
            document.getElementById('payLoansModal').style.display = 'flex';
        }

        function payOffLoan(loanIndex) {
            const player = gameState.players[gameState.currentPlayer];
            const loan = player.loans[loanIndex];
            
            if (player.cash < loan.amount) {
                alert("Dinheiro insuficiente!");
                return;
            }
            
            player.cash -= loan.amount;
            player.expenses -= loan.monthlyPayment;
            player.loans.splice(loanIndex, 1);
            
            addLog(`‚úÖ ${player.name} quitou um empr√©stimo de R$ ${loan.amount.toLocaleString()}`);
            
            closeModal('payLoansModal');
            updateCurrentPlayerInfo();
            updatePayLoansButton();
        }

        // =========== DADOS ===========
        function rollDice() {
            if (!gameState.gameActive) return;
            
            const player = gameState.players[gameState.currentPlayer];
            
            if (!player.inRatRace) {
                showFastTrackOpportunity();
                return;
            }
            
            const rollBtn = document.getElementById('rollDiceBtn');
            rollBtn.disabled = true;
            
            const dice1 = document.getElementById('dice1');
            dice1.style.display = 'flex';
            dice1.classList.add('rolling');
            
            setTimeout(() => {
                const dice1Value = Math.floor(Math.random() * 6) + 1;
                dice1.textContent = dice1Value;
                dice1.classList.remove('rolling');
                
                addLog(`üé≤ ${player.name} rolou ${dice1Value}`);
                
                movePlayer(gameState.currentPlayer, dice1Value);
                document.getElementById('endTurnBtn').disabled = false;
                
                setTimeout(() => {
                    showCardForSpace(player.position);
                }, 500);
                
            }, 800);
        }

        function movePlayer(playerId, steps) {
            const player = gameState.players[playerId];
            const oldPosition = player.position;
            
            let newPosition = (player.position + steps) % 25;
            
            if (newPosition < oldPosition && steps > 0) {
                player.lapsCompleted++;
                gameState.totalLaps = Math.max(gameState.totalLaps, player.lapsCompleted);
                
                payday(playerId);
                addLog(`üîÑ ${player.name} completou uma volta!`);
            }
            
            player.position = newPosition;
            updateBoard();
            updateCurrentPlayerInfo();
            updateGameStats();
        }

        // =========== CARTAS DO ESPA√áO ===========
        function showCardForSpace(position) {
            const space = gameState.spaces[position];
            const player = gameState.players[gameState.currentPlayer];
            
            addLog(`üìç ${player.name} est√° no espa√ßo ${space.num}: ${space.name}`);
            
            // Scroll autom√°tico para a carta
            setTimeout(() => {
                const cardDisplay = document.getElementById('cardDisplay');
                if (cardDisplay.style.display === 'block') {
                    cardDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);
            
            switch(space.type) {
                case 'payday':
                    payday(gameState.currentPlayer);
                    break;
                case 'baby':
                    haveBaby(gameState.currentPlayer);
                    break;
                case 'charity':
                    charity(gameState.currentPlayer);
                    break;
                case 'downsized':
                    downsized(gameState.currentPlayer);
                    break;
                case 'opportunity':
                    // 70% Small Deal, 30% Big Deal
                    const isSmallDeal = Math.random() < 0.7;
                    if (isSmallDeal) {
                        showSmallDeal(gameState.currentPlayer);
                    } else {
                        showBigDeal(gameState.currentPlayer);
                    }
                    break;
                case 'doodad':
                    showDoodadCard(gameState.currentPlayer);
                    break;
                case 'market':
                    showMarketCard(gameState.currentPlayer);
                    break;
            }
        }

        // =========== NOVAS CARTAS PEQUENAS (COM CUSTO) ===========
        function showSmallDeal(playerId) {
            const card = smallDealCards[Math.floor(Math.random() * smallDealCards.length)];
            gameState.currentCard = { ...card, playerId: playerId, cardType: 'small' };
            
            const display = document.getElementById('cardDisplay');
            const title = document.getElementById('cardTitle');
            const typeTag = document.getElementById('cardTypeTag');
            const description = document.getElementById('cardDescription');
            const details = document.getElementById('cardDetails');
            const actions = document.getElementById('cardActions');
            
            title.textContent = card.name;
            typeTag.textContent = 'PEQUENA OPORTUNIDADE';
            typeTag.style.backgroundColor = '#3498db';
            description.textContent = card.description;
            
            details.innerHTML = `
                <div class="card-detail">
                    <div class="detail-label">Tipo</div>
                    <div class="detail-value">${card.type === 'a√ß√µes' ? 'A√ß√µes' : card.type === 'renda' ? 'Renda Passiva' : 'Ativo Digital'}</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Custo</div>
                    <div class="detail-value">R$ ${card.cost.toLocaleString()}</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Renda por Payday</div>
                    <div class="detail-value" style="color: #2ecc71;">+R$ ${card.cashflow}/m√™s</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Retorno</div>
                    <div class="detail-value" style="color: #f39c12;">${Math.round((card.cashflow / card.cost) * 100 * 12)}% ao ano</div>
                </div>
            `;
            
            actions.innerHTML = `
                <button class="button button-success" onclick="buySmallDeal()">
                    <i class="fas fa-check"></i> COMPRAR
                </button>
                <button class="button" onclick="declineCard()">
                    <i class="fas fa-times"></i> RECUSAR
                </button>
            `;
            
            display.style.display = 'block';
        }

        function buySmallDeal() {
            const card = gameState.currentCard;
            const player = gameState.players[card.playerId];
            
            if (player.cash < card.cost) {
                if (confirm(`Dinheiro insuficiente! Voc√™ tem R$ ${player.cash.toLocaleString()}, precisa de R$ ${card.cost.toLocaleString()}.\n\nDeseja pegar um empr√©stimo?`)) {
                    showLoanModal();
                }
                return;
            }
            
            player.cash -= card.cost;
            player.passiveIncome += card.cashflow;
            
            // Adicionar ao tipo correto de ativos
            if (card.type === 'a√ß√µes') {
                player.assets.stocks.push({
                    name: card.name,
                    cost: card.cost,
                    cashflow: card.cashflow,
                    type: 'a√ß√µes'
                });
            } else if (card.type === 'renda') {
                player.assets.realEstate.push({
                    name: card.name,
                    cost: card.cost,
                    cashflow: card.cashflow,
                    type: 'renda'
                });
            } else {
                player.assets.businesses.push({
                    name: card.name,
                    cost: card.cost,
                    cashflow: card.cashflow,
                    type: 'digital'
                });
            }
            
            addLog(`‚úÖ ${player.name} comprou ${card.name} por R$ ${card.cost.toLocaleString()} (+R$ ${card.cashflow}/m√™s)`);
            
            checkExitRatRace(card.playerId);
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
            updatePayLoansButton();
        }

        // =========== BIG DEALS ===========
        function showBigDeal(playerId) {
            const player = gameState.players[playerId];
            const availableCards = bigDealCards.filter(card => {
                if (!card.requires) return true;
                if (card.requires === "1 volta completa") {
                    return player.lapsCompleted >= 1;
                }
                if (card.requires.includes("renda passiva m√≠nima")) {
                    const minIncome = parseInt(card.requires.match(/R\$ (\d+)/)[1]);
                    return player.passiveIncome >= minIncome;
                }
                return true;
            });
            
            if (availableCards.length === 0) {
                showSmallDeal(playerId);
                return;
            }
            
            const card = availableCards[Math.floor(Math.random() * availableCards.length)];
            gameState.currentCard = { ...card, playerId: playerId, cardType: 'big' };
            
            const display = document.getElementById('cardDisplay');
            const title = document.getElementById('cardTitle');
            const typeTag = document.getElementById('cardTypeTag');
            const description = document.getElementById('cardDescription');
            const details = document.getElementById('cardDetails');
            const actions = document.getElementById('cardActions');
            
            title.textContent = card.name;
            typeTag.textContent = 'GRANDE OPORTUNIDADE';
            typeTag.style.backgroundColor = '#e67e22';
            description.textContent = card.description;
            
            details.innerHTML = `
                <div class="card-detail">
                    <div class="detail-label">Tipo</div>
                    <div class="detail-value">${card.type === 'im√≥vel' ? 'Im√≥vel' : 'Neg√≥cio'}</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Valor Total</div>
                    <div class="detail-value">R$ ${card.cost.toLocaleString()}</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Entrada</div>
                    <div class="detail-value">R$ ${card.downPayment.toLocaleString()}</div>
                </div>
                ${card.mortgage ? `
                <div class="card-detail">
                    <div class="detail-label">Financiamento</div>
                    <div class="detail-value">R$ ${card.mortgage.toLocaleString()}</div>
                </div>
                ` : ''}
                <div class="card-detail">
                    <div class="detail-label">Renda por Payday</div>
                    <div class="detail-value" style="color: #2ecc71;">+R$ ${card.cashflow}/m√™s</div>
                </div>
                ${card.requires ? `
                <div class="card-detail">
                    <div class="detail-label">Pr√©-requisito</div>
                    <div class="detail-value" style="color: #3498db;">${card.requires}</div>
                </div>
                ` : ''}
            `;
            
            actions.innerHTML = `
                <button class="button button-success" onclick="buyBigDeal()">
                    <i class="fas fa-check"></i> COMPRAR
                </button>
                <button class="button" onclick="declineCard()">
                    <i class="fas fa-times"></i> RECUSAR
                </button>
            `;
            
            display.style.display = 'block';
        }

        function buyBigDeal() {
            const card = gameState.currentCard;
            const player = gameState.players[card.playerId];
            
            if (player.cash < card.downPayment) {
                if (confirm(`Dinheiro insuficiente para entrada! Deseja pegar empr√©stimo?`)) {
                    showLoanModal();
                }
                return;
            }
            
            player.cash -= card.downPayment;
            player.passiveIncome += card.cashflow;
            
            if (card.type === 'im√≥vel') {
                player.assets.realEstate.push({
                    name: card.name,
                    cost: card.cost,
                    downPayment: card.downPayment,
                    mortgage: card.mortgage || 0,
                    cashflow: card.cashflow,
                    type: 'im√≥vel'
                });
            } else {
                player.assets.businesses.push({
                    name: card.name,
                    cost: card.cost,
                    downPayment: card.downPayment,
                    mortgage: card.mortgage || 0,
                    cashflow: card.cashflow,
                    type: 'neg√≥cio'
                });
            }
            
            addLog(`‚úÖ ${player.name} comprou ${card.name} por R$ ${card.downPayment.toLocaleString()} de entrada (+R$ ${card.cashflow}/m√™s)`);
            
            checkExitRatRace(card.playerId);
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
            updatePayLoansButton();
        }

        // =========== DOODADS ESCALONADOS ===========
        function showDoodadCard(playerId) {
            const player = gameState.players[playerId];
            
            if (gameState.nextDoodadProtected && gameState.protectedPlayer === playerId) {
                addLog(`üõ°Ô∏è ${player.name} usou prote√ß√£o! Doodad anulado.`);
                gameState.nextDoodadProtected = false;
                gameState.protectedPlayer = null;
                return;
            }
            
            // Determinar categoria baseada nas voltas
            let doodadCategory;
            if (player.lapsCompleted <= 3) {
                doodadCategory = "voltas_1_3";
            } else if (player.lapsCompleted <= 6) {
                doodadCategory = "voltas_4_6";
            } else if (player.lapsCompleted <= 9) {
                doodadCategory = "voltas_7_9";
            } else {
                doodadCategory = "voltas_10_mais";
            }
            
            const availableDoodads = doodadCardsByLaps[doodadCategory];
            const card = availableDoodads[Math.floor(Math.random() * availableDoodads.length)];
            
            gameState.currentCard = { ...card, playerId: playerId, cardType: 'doodad' };
            
            const display = document.getElementById('cardDisplay');
            const title = document.getElementById('cardTitle');
            const typeTag = document.getElementById('cardTypeTag');
            const description = document.getElementById('cardDescription');
            const details = document.getElementById('cardDetails');
            const actions = document.getElementById('cardActions');
            
            title.textContent = card.name;
            typeTag.textContent = 'DOODAD';
            typeTag.style.backgroundColor = '#e74c3c';
            description.textContent = card.description;
            
            details.innerHTML = `
                <div class="card-detail">
                    <div class="detail-label">Tipo</div>
                    <div class="detail-value">Despesa Obrigat√≥ria</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Categoria</div>
                    <div class="detail-value">${doodadCategory.replace('_', ' ')}</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Suas Voltas</div>
                    <div class="detail-value">${player.lapsCompleted}</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Custo</div>
                    <div class="detail-value" style="color: #e74c3c;">R$ ${card.cost.toLocaleString()}</div>
                </div>
            `;
            
            actions.innerHTML = `
                <button class="button button-danger" onclick="payDoodad()">
                    <i class="fas fa-check"></i> PAGAR
                </button>
            `;
            
            display.style.display = 'block';
        }

        function payDoodad() {
            const card = gameState.currentCard;
            const player = gameState.players[card.playerId];
            
            if (player.cash >= card.cost) {
                // Tem dinheiro suficiente
                player.cash -= card.cost;
                addLog(`üí∏ ${player.name} pagou R$ ${card.cost.toLocaleString()} por ${card.name}`);
            } else {
                // N√£o tem dinheiro suficiente - criar d√≠vida
                const deficit = card.cost - player.cash;
                player.cash = 0;
                
                const loanAmount = deficit;
                const monthlyPayment = loanAmount * 0.1;
                
                player.loans.push({
                    amount: loanAmount,
                    monthlyPayment: monthlyPayment,
                    reason: "Doodad - D√©ficit autom√°tico"
                });
                
                player.expenses += monthlyPayment;
                
                addLog(`üí∏ ${player.name} pagou R$ ${(card.cost - deficit).toLocaleString()} e gerou d√≠vida de R$ ${loanAmount.toLocaleString()} por ${card.name}`);
                addLog(`üè¶ Empr√©stimo autom√°tico: R$ ${loanAmount.toLocaleString()} (pagamento: R$ ${monthlyPayment.toLocaleString()}/m√™s)`);
            }
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
            updatePayLoansButton();
        }

        // =========== MERCADO ===========
        function showMarketCard(playerId) {
            const card = marketCards[Math.floor(Math.random() * marketCards.length)];
            gameState.currentCard = { ...card, playerId: playerId, cardType: 'market' };
            gameState.marketEvent = card;
            
            const display = document.getElementById('cardDisplay');
            const title = document.getElementById('cardTitle');
            const typeTag = document.getElementById('cardTypeTag');
            const description = document.getElementById('cardDescription');
            const details = document.getElementById('cardDetails');
            const actions = document.getElementById('cardActions');
            
            title.textContent = card.name;
            typeTag.textContent = 'MERCADO';
            typeTag.style.backgroundColor = card.type === 'alta' ? '#2ecc71' : '#e74c3c';
            description.textContent = card.description;
            
            details.innerHTML = `
                <div class="card-detail">
                    <div class="detail-label">Tipo</div>
                    <div class="detail-value" style="color: ${card.type === 'alta' ? '#2ecc71' : '#e74c3c'}">
                        ${card.type === 'alta' ? 'ALTA' : 'BAIXA'}
                    </div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Ativo</div>
                    <div class="detail-value">${card.assetType === 'im√≥vel' ? 'IM√ìVEIS' : 'A√á√ïES'}</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Varia√ß√£o</div>
                    <div class="detail-value" style="color: ${card.modifier > 1 ? '#2ecc71' : '#e74c3c'}">
                        ${((card.modifier - 1) * 100).toFixed(0)}%
                    </div>
                </div>
            `;
            
            if (card.type === 'alta') {
                if (card.assetType === 'im√≥vel') {
                    actions.innerHTML = `
                        <button class="button button-success" onclick="showSellRealEstateModal(${playerId})">
                            <i class="fas fa-home"></i> VENDER IM√ìVEIS
                        </button>
                        <button class="button" onclick="declineCard()">
                            <i class="fas fa-times"></i> MANTER
                        </button>
                    `;
                } else {
                    actions.innerHTML = `
                        <button class="button button-success" onclick="showSellStocksModal(${playerId})">
                            <i class="fas fa-chart-line"></i> VENDER A√á√ïES
                        </button>
                        <button class="button" onclick="declineCard()">
                            <i class="fas fa-times"></i> MANTER
                        </button>
                    `;
                }
            } else {
                actions.innerHTML = `
                    <button class="button" onclick="declineCard()">
                        <i class="fas fa-check"></i> ENTENDI
                    </button>
                `;
            }
            
            display.style.display = 'block';
        }

        function showSellRealEstateModal(playerId) {
            const player = gameState.players[playerId];
            const marketCard = gameState.marketEvent;
            
            if (player.assets.realEstate.length === 0) {
                alert("Voc√™ n√£o possui im√≥veis!");
                declineCard();
                return;
            }
            
            let html = '<p>Selecione im√≥veis para vender:</p>';
            
            player.assets.realEstate.forEach((asset, index) => {
                const saleValue = Math.round(asset.cost * marketCard.modifier);
                const profit = saleValue - asset.cost;
                
                html += `
                    <div class="asset-item">
                        <div class="asset-info">
                            <strong>${asset.name}</strong><br>
                            <small>Valor: R$ ${saleValue.toLocaleString()} (${profit > 0 ? '+' : ''}R$ ${profit.toLocaleString()})</small><br>
                            <small>Renda atual: R$ ${asset.cashflow}/m√™s</small>
                        </div>
                        <div class="sell-checkbox">
                            <input type="checkbox" id="realEstate${index}" data-index="${index}" data-value="${saleValue}" data-cashflow="${asset.cashflow}">
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('sellAssetsContent').innerHTML = html;
            document.getElementById('sellAssetsModal').style.display = 'flex';
        }

        function confirmSellAssets() {
            const player = gameState.players[gameState.currentCard.playerId];
            const checkboxes = document.querySelectorAll('#sellAssetsContent input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert("Selecione pelo menos um im√≥vel!");
                return;
            }
            
            const indicesToRemove = [];
            let totalCash = 0;
            let totalCashflowReduction = 0;
            
            checkboxes.forEach(checkbox => {
                const index = parseInt(checkbox.dataset.index);
                const saleValue = parseInt(checkbox.dataset.value);
                const cashflow = parseInt(checkbox.dataset.cashflow);
                indicesToRemove.push({ index, saleValue, cashflow });
            });
            
            indicesToRemove.sort((a, b) => b.index - a.index);
            
            indicesToRemove.forEach(item => {
                const asset = player.assets.realEstate[item.index];
                player.cash += item.saleValue;
                player.passiveIncome -= item.cashflow;
                totalCash += item.saleValue;
                totalCashflowReduction += item.cashflow;
                
                addLog(`üí∞ ${player.name} vendeu ${asset.name} por R$ ${item.saleValue.toLocaleString()}`);
                
                player.assets.realEstate.splice(item.index, 1);
            });
            
            addLog(`üìä Total recebido: R$ ${totalCash.toLocaleString()}`);
            
            closeModal('sellAssetsModal');
            declineCard();
            updateCurrentPlayerInfo();
        }

        function showSellStocksModal(playerId) {
            const player = gameState.players[playerId];
            const marketCard = gameState.marketEvent;
            
            if (player.assets.stocks.length === 0) {
                alert("Voc√™ n√£o possui a√ß√µes!");
                declineCard();
                return;
            }
            
            let html = '<p>Selecione a√ß√µes para vender:</p>';
            
            player.assets.stocks.forEach((asset, index) => {
                const saleValue = Math.round(asset.cost * marketCard.modifier);
                const profit = saleValue - asset.cost;
                
                html += `
                    <div class="asset-item">
                        <div class="asset-info">
                            <strong>${asset.name}</strong><br>
                            <small>Valor: R$ ${saleValue.toLocaleString()} (${profit > 0 ? '+' : ''}R$ ${profit.toLocaleString()})</small><br>
                            <small>Renda atual: R$ ${asset.cashflow}/m√™s</small>
                        </div>
                        <div class="sell-checkbox">
                            <input type="checkbox" id="stocks${index}" data-index="${index}" data-value="${saleValue}" data-cashflow="${asset.cashflow}">
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('sellStocksContent').innerHTML = html;
            document.getElementById('sellStocksModal').style.display = 'flex';
        }

        function confirmSellStocks() {
            const player = gameState.players[gameState.currentCard.playerId];
            const checkboxes = document.querySelectorAll('#sellStocksContent input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert("Selecione pelo menos uma a√ß√£o!");
                return;
            }
            
            const indicesToRemove = [];
            let totalCash = 0;
            let totalCashflowReduction = 0;
            
            checkboxes.forEach(checkbox => {
                const index = parseInt(checkbox.dataset.index);
                const saleValue = parseInt(checkbox.dataset.value);
                const cashflow = parseInt(checkbox.dataset.cashflow);
                indicesToRemove.push({ index, saleValue, cashflow });
            });
            
            indicesToRemove.sort((a, b) => b.index - a.index);
            
            indicesToRemove.forEach(item => {
                const asset = player.assets.stocks[item.index];
                player.cash += item.saleValue;
                player.passiveIncome -= item.cashflow;
                totalCash += item.saleValue;
                totalCashflowReduction += item.cashflow;
                
                addLog(`üí∞ ${player.name} vendeu ${asset.name} por R$ ${item.saleValue.toLocaleString()}`);
                player.assets.stocks.splice(item.index, 1);
            });
            
            addLog(`üìä Total recebido: R$ ${totalCash.toLocaleString()}`);
            
            closeModal('sellStocksModal');
            declineCard();
            updateCurrentPlayerInfo();
        }

        // =========== EVENTOS DO TABULEIRO ===========
        function payday(playerId) {
            const player = gameState.players[playerId];
            
            if (player.isDownsized) {
                player.downsizedRounds++;
                if (player.downsizedRounds >= 2) {
                    player.isDownsized = false;
                    player.downsizedRounds = 0;
                    addLog(`üéâ ${player.name} voltou ao trabalho!`);
                } else {
                    const childExpenses = player.children * player.perChildCost;
                    const totalExpenses = player.expenses + childExpenses;
                    const totalIncome = player.passiveIncome;
                    
                    let loanPayments = 0;
                    player.loans.forEach(loan => {
                        loanPayments += loan.monthlyPayment;
                    });
                    
                    const netIncome = Math.max(totalIncome - totalExpenses - loanPayments, 0);
                    player.cash += netIncome;
                    
                    addLog(`‚è∏Ô∏è ${player.name} est√° demitido! Recebeu: R$ ${netIncome.toLocaleString()}`);
                    updateCurrentPlayerInfo();
                    return;
                }
            }
            
            const childExpenses = player.children * player.perChildCost;
            const totalExpenses = player.expenses + childExpenses;
            const totalIncome = player.salary + player.passiveIncome;
            
            let loanPayments = 0;
            player.loans.forEach(loan => {
                loanPayments += loan.monthlyPayment;
            });
            
            const netIncome = Math.max(totalIncome - totalExpenses - loanPayments, 0);
            player.cash += netIncome;
            
            addLog(`üí∞ ${player.name} recebeu: R$ ${netIncome.toLocaleString()}`);
            
            updateCurrentPlayerInfo();
        }

        function haveBaby(playerId) {
            const player = gameState.players[playerId];
            
            if (player.children >= player.maxChildren) {
                addLog(`üë∂ ${player.name} j√° tem 3 filhos!`);
                return;
            }
            
            player.children++;
            addLog(`üë∂ ${player.name} teve um beb√™! Total: ${player.children}`);
            updateCurrentPlayerInfo();
        }

        function charity(playerId) {
            const player = gameState.players[playerId];
            const amount = Math.floor(player.salary * 0.1);
            
            if (player.cash >= amount) {
                player.cash -= amount;
                addLog(`‚ù§Ô∏è ${player.name} doou R$ ${amount.toLocaleString()}`);
                
                gameState.dice3Enabled = true;
                gameState.charityPlayer = playerId;
                gameState.charityRoundsLeft = 3;
                
                document.getElementById('dice2').style.display = 'flex';
                addLog(`üé≤ Pr√≥ximas 3 rodadas, ${player.name} pode rolar 2 dados!`);
            } else {
                alert(`Dinheiro insuficiente para caridade!`);
            }
            
            updateCurrentPlayerInfo();
        }

        function downsized(playerId) {
            const player = gameState.players[playerId];
            const childExpenses = player.children * player.perChildCost;
            const totalExpenses = player.expenses + childExpenses;
            
            if (player.cash >= totalExpenses) {
                player.cash -= totalExpenses;
                addLog(`‚ö†Ô∏è ${player.name} foi demitido! Pagou R$ ${totalExpenses.toLocaleString()}`);
            } else {
                const deficit = totalExpenses - player.cash;
                player.cash = 0;
                
                const loanAmount = deficit;
                const monthlyPayment = loanAmount * 0.1;
                
                player.loans.push({
                    amount: loanAmount,
                    monthlyPayment: monthlyPayment
                });
                
                player.expenses += monthlyPayment;
                
                addLog(`‚ö†Ô∏è ${player.name} foi demitido! Empr√©stimo gerado: R$ ${loanAmount.toLocaleString()}`);
            }
            
            player.isDownsized = true;
            player.downsizedRounds = 0;
            
            updateCurrentPlayerInfo();
            updatePayLoansButton();
        }

        function checkExitRatRace(playerId) {
            const player = gameState.players[playerId];
            const childExpenses = player.children * player.perChildCost;
            const totalExpenses = player.expenses + childExpenses;
            
            if (player.passiveIncome > totalExpenses && player.inRatRace) {
                player.inRatRace = false;
                addLog(`üöÄüéâ ${player.name} SAIU DA CORRIDA DOS RATOS!`);
                
                updateBoard();
                updateGameStats();
            }
        }

        // =========== FAST TRACK ===========
        function showFastTrackOpportunity() {
            const player = gameState.players[gameState.currentPlayer];
            const card = fastTrackCards[Math.floor(Math.random() * fastTrackCards.length)];
            gameState.currentCard = { ...card, playerId: player.id, cardType: 'fast' };
            
            const display = document.getElementById('cardDisplay');
            const title = document.getElementById('cardTitle');
            const typeTag = document.getElementById('cardTypeTag');
            const description = document.getElementById('cardDescription');
            const details = document.getElementById('cardDetails');
            const actions = document.getElementById('cardActions');
            
            title.textContent = card.nome;
            typeTag.textContent = 'FAST TRACK';
            typeTag.style.backgroundColor = '#9b59b6';
            description.textContent = card.descricao;
            
            if (card.tipo === 'gasto') {
                details.innerHTML = `
                    <div class="card-detail">
                        <div class="detail-label">Tipo</div>
                        <div class="detail-value">Experi√™ncia</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Custo</div>
                        <div class="detail-value" style="color: #e74c3c;">R$ ${card.custo.toLocaleString()}</div>
                    </div>
                `;
                
                actions.innerHTML = `
                    <button class="button ${player.cash >= card.custo ? 'button-danger' : ''}" onclick="fastTrackSpend(${player.id})" ${player.cash < card.custo ? 'disabled' : ''}>
                        <i class="fas fa-check"></i> ${player.cash >= card.custo ? 'GASTAR' : 'DINHEIRO INSUFICIENTE'}
                    </button>
                    <button class="button" onclick="declineCard()">
                        <i class="fas fa-times"></i> RECUSAR
                    </button>
                `;
                
            } else if (card.tipo === 'investimento') {
                details.innerHTML = `
                    <div class="card-detail">
                        <div class="detail-label">Tipo</div>
                        <div class="detail-value">Investimento</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Entrada</div>
                        <div class="detail-value">R$ ${card.entrada.toLocaleString()}</div>
                    </div>
                `;
                
                actions.innerHTML = `
                    <button class="button ${player.cash >= card.entrada ? 'button-success' : ''}" onclick="fastTrackInvest(${player.id})" ${player.cash < card.entrada ? 'disabled' : ''}>
                        <i class="fas fa-check"></i> ${player.cash >= card.entrada ? 'INVESTIR' : 'DINHEIRO INSUFICIENTE'}
                    </button>
                    <button class="button" onclick="declineCard()">
                        <i class="fas fa-times"></i> RECUSAR
                    </button>
                `;
                
            } else if (card.tipo === 'penalidade') {
                if (card.id === 'auditoria') {
                    const amount = Math.floor(player.cash * 0.5);
                    details.innerHTML = `
                        <div class="card-detail">
                            <div class="detail-label">Tipo</div>
                            <div class="detail-value">Penalidade</div>
                        </div>
                        <div class="card-detail">
                            <div class="detail-label">Multa</div>
                            <div class="detail-value" style="color: #e74c3c;">50% do seu dinheiro</div>
                        </div>
                    `;
                    
                    actions.innerHTML = `
                        <button class="button button-danger" onclick="fastTrackPenalty(${player.id})">
                            <i class="fas fa-exclamation-triangle"></i> PAGAR
                        </button>
                    `;
                }
            }
            
            display.style.display = 'block';
        }

        function fastTrackSpend(playerId) {
            const card = gameState.currentCard;
            const player = gameState.players[playerId];
            
            if (player.cash < card.custo) {
                alert("Dinheiro insuficiente!");
                return;
            }
            
            player.cash -= card.custo;
            
            if (card.nome === player.assignedDream) {
                player.dreams.push(card.nome);
                declareWinner(playerId);
            } else {
                addLog(`üí∏ ${player.name} gastou R$ ${card.custo.toLocaleString()}`);
            }
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
        }

        function fastTrackInvest(playerId) {
            const card = gameState.currentCard;
            const player = gameState.players[playerId];
            
            if (player.cash < card.entrada) {
                alert("Dinheiro insuficiente!");
                return;
            }
            
            player.cash -= card.entrada;
            
            if (card.ccr) {
                const monthlyReturn = Math.round((card.entrada * (card.ccr / 100)) / 12);
                player.passiveIncome += monthlyReturn;
                addLog(`‚úÖ ${player.name} investiu R$ ${card.entrada.toLocaleString()}`);
            }
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
        }

        function fastTrackPenalty(playerId) {
            const card = gameState.currentCard;
            const player = gameState.players[playerId];
            
            if (card.id === 'auditoria') {
                const amount = Math.floor(player.cash * 0.5);
                player.cash -= amount;
                addLog(`‚ö†Ô∏è ${player.name} pagou R$ ${amount.toLocaleString()} em auditoria`);
            }
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
        }

        // =========== VIT√ìRIA ===========
        function declareWinner(playerId) {
            const player = gameState.players[playerId];
            gameState.gameActive = false;
            
            const winnerDiv = document.getElementById('winnerMessage');
            winnerDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, #9b59b6, #8e44ad); 
                           color: white; padding: 20px; border-radius: 10px; 
                           text-align: center; margin-top: 15px; font-weight: bold; font-size: 1.2rem;">
                    üèÜüéâ ${player.name} VENCEU O JOGO! üéâüèÜ<br>
                    <small>Realizou o sonho: ${player.assignedDream}</small>
                </div>
            `;
            
            addLog(`üèÜüéâ ${player.name} VENCEU O JOGO!`);
            
            document.getElementById('rollDiceBtn').disabled = true;
            document.getElementById('endTurnBtn').disabled = true;
        }

        // =========== TURNO ===========
        function endTurn() {
            gameState.currentPlayer = gameState.currentPlayer % gameState.totalPlayers + 1;
            
            if (gameState.currentPlayer === 1) {
                gameState.currentRound++;
                addLog(`üìÖ RODADA ${gameState.currentRound} INICIADA`);
                updateGameStats();
            }
            
            document.getElementById('endTurnBtn').disabled = true;
            document.getElementById('rollDiceBtn').disabled = false;
            
            document.getElementById('cardDisplay').style.display = 'none';
            
            updateCurrentPlayerInfo();
            updateProtectionButton();
            updatePayLoansButton();
            
            const playerName = gameState.players[gameState.currentPlayer].name;
            addLog(`üîÑ Vez de: ${playerName}`);
            
            // REMOVIDO: Scroll autom√°tico ao finalizar turno
            // A tela n√£o se mexe mais quando clicar em finalizar rodada
            
            if (!gameState.players[gameState.currentPlayer].inRatRace) {
                setTimeout(() => {
                    showFastTrackOpportunity();
                }, 500);
            }
        }

        // =========== ATIVOS ===========
        function showAssets() {
            const player = gameState.players[gameState.currentPlayer];
            let html = `<h3 style="color: var(--secondary); margin-bottom: 15px;">${player.name}</h3>`;
            
            const childExpenses = player.children * player.perChildCost;
            const totalExpenses = player.expenses + childExpenses;
            
            let totalLoans = 0;
            let totalLoanPayments = 0;
            player.loans.forEach(loan => {
                totalLoans += loan.amount;
                totalLoanPayments += loan.monthlyPayment;
            });
            
            const totalIncome = player.salary + player.passiveIncome;
            const netIncome = Math.max(totalIncome - totalExpenses - totalLoanPayments, 0);
            
            html += `
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">Sal√°rio</div>
                            <div style="font-weight: bold;">R$ ${player.salary.toLocaleString()}/m√™s</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">Renda Passiva</div>
                            <div style="font-weight: bold; color: #2ecc71;">R$ ${player.passiveIncome.toLocaleString()}/m√™s</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">Despesas Totais</div>
                            <div style="font-weight: bold; color: #e74c3c;">R$ ${totalExpenses.toLocaleString()}/m√™s</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">Fluxo de Caixa</div>
                            <div style="font-weight: bold; color: ${netIncome >= 0 ? '#2ecc71' : '#e74c3c'}">
                                R$ ${netIncome.toLocaleString()}/m√™s
                            </div>
                        </div>
                        ${totalLoans > 0 ? `
                        <div style="grid-column: 1 / -1;">
                            <div style="color: #666; font-size: 0.9rem;">Empr√©stimos</div>
                            <div style="font-weight: bold; color: #e74c3c;">
                                Total: R$ ${totalLoans.toLocaleString()}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            if (player.assets.stocks.length > 0) {
                html += `<h4 style="color: #3498db; margin-top: 15px;">A√á√ïES</h4>`;
                player.assets.stocks.forEach((stock, index) => {
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                            <div><strong>${stock.name}</strong></div>
                            <div>Investido: R$ ${stock.cost.toLocaleString()}</div>
                            <div style="color: #2ecc71;">Renda: R$ ${stock.cashflow}/m√™s</div>
                        </div>
                    `;
                });
            }
            
            if (player.assets.realEstate.length > 0) {
                html += `<h4 style="color: #e67e22; margin-top: 15px;">IM√ìVEIS E RENDA PASSIVA</h4>`;
                player.assets.realEstate.forEach((property, index) => {
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                            <div><strong>${property.name}</strong></div>
                            <div>Investido: R$ ${property.cost.toLocaleString()}</div>
                            <div style="color: #2ecc71;">Renda: R$ ${property.cashflow}/m√™s</div>
                        </div>
                    `;
                });
            }
            
            if (player.assets.businesses.length > 0) {
                html += `<h4 style="color: #9b59b6; margin-top: 15px;">NEG√ìCIOS E ATIVOS DIGITAIS</h4>`;
                player.assets.businesses.forEach((business, index) => {
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                            <div><strong>${business.name}</strong></div>
                            <div>Investido: R$ ${business.cost.toLocaleString()}</div>
                            <div style="color: #2ecc71;">Renda: R$ ${business.cashflow}/m√™s</div>
                        </div>
                    `;
                });
            }
            
            if (player.assets.stocks.length === 0 && player.assets.realEstate.length === 0 && 
                player.assets.businesses.length === 0 && player.assets.bonds.length === 0) {
                html += '<p>Nenhum ativo adquirido.</p>';
            }
            
            html += `<h4 style="color: #f39c12; margin-top: 20px;">SONHO</h4>`;
            html += `<p><strong>${player.assignedDream}</strong></p>`;
            
            document.getElementById('assetsContent').innerHTML = html;
            document.getElementById('assetsModal').style.display = 'flex';
        }

        // =========== FUN√á√ïES AUXILIARES ===========
        function addLog(message) {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            log.prepend(entry);
            
            if (log.children.length > 30) {
                log.removeChild(log.lastChild);
            }
        }

        function clearLog() {
            document.getElementById('gameLog').innerHTML = '<div class="log-entry">Hist√≥rico limpo</div>';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function declineCard() {
            const player = gameState.players[gameState.currentCard.playerId];
            addLog(`‚ùå ${player.name} recusou a oferta`);
            document.getElementById('cardDisplay').style.display = 'none';
        }

        // =========== INICIALIZAR ===========
        document.addEventListener('DOMContentLoaded', initializeGame);
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashflow Online | Edi√ß√£o Original</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2C3E50;
            --secondary: #3498DB;
            --success: #2ECC71;
            --danger: #E74C3C;
            --warning: #F39C12;
            --light: #ECF0F1;
            --dark: #2C3E50;
            --player1: #E74C3C;
            --player2: #3498DB;
            --player3: #2ECC71;
            --player4: #9B59B6;
            --player5: #F39C12;
            --player6: #1ABC9C;
            --protection: #27ae60;
        }

        body {
            background: linear-gradient(135deg, #1a2a3a, #2c3e50);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* CONFIGURA√á√ÉO INICIAL */
        .setup-screen {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid var(--warning);
            max-width: 800px;
            margin: 20px auto;
        }

        .setup-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: bold;
            color: var(--warning);
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .player-names-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        /* TABELA DO TABULEIRO */
        .board-table-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            border: 2px solid var(--secondary);
        }

        .board-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0 auto;
        }

        .board-table th {
            background: var(--secondary);
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
        }

        .board-table td {
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            vertical-align: middle;
            min-width: 120px;
            position: relative;
        }

        .board-table td:first-child {
            width: 40px;
            min-width: 40px;
        }

        .space-number {
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--warning);
            padding: 2px 4px;
            background: rgba(243, 156, 18, 0.2);
            border-radius: 4px;
            display: inline-block;
            width: 30px;
        }

        .space-type {
            font-size: 0.8rem;
            margin: 3px 0;
        }

        .space-action {
            font-size: 0.75rem;
            color: #bdc3c7;
        }

        .player-markers-cell {
            min-width: 180px;
        }

        /* Cores dos espa√ßos */
        .space-start { background: rgba(243, 156, 18, 0.15); border-left: 4px solid var(--warning); }
        .space-opportunity { background: rgba(52, 152, 219, 0.15); border-left: 4px solid var(--player2); }
        .space-payday { background: rgba(155, 89, 182, 0.15); border-left: 4px solid var(--player4); }
        .space-doodad { background: rgba(231, 76, 60, 0.25); border-left: 4px solid var(--player1); }
        .space-market { background: rgba(46, 204, 113, 0.15); border-left: 4px solid var(--success); }
        .space-baby { background: rgba(241, 196, 15, 0.15); border-left: 4px solid #F1C40F; }
        .space-downsized { background: rgba(230, 126, 34, 0.15); border-left: 4px solid #E67E22; }
        .space-charity { background: rgba(230, 126, 34, 0.15); border-left: 4px solid #E67E22; }

        /* Marcadores dos jogadores */
        .player-markers {
            display: flex;
            justify-content: center;
            gap: 3px;
            margin-top: 5px;
            flex-wrap: wrap;
        }

        .player-marker {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* CONTROLES */
        .controls {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            border: 2px solid var(--secondary);
        }

        .dice-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .dice {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            user-select: none;
        }

        .dice.rolling {
            animation: roll 0.5s infinite;
        }

        @keyframes roll {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .button-success { background: var(--success); }
        .button-danger { background: var(--danger); }
        .button-warning { background: var(--warning); }
        .button-purple { background: #9b59b6; }
        .button-protection { background: var(--protection); }

        /* CARD DISPLAY */
        .card-display {
            background: white;
            color: var(--dark);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: none;
            border-top: 8px solid var(--secondary);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .card-title {
            color: var(--secondary);
            font-size: 1.3rem;
            font-weight: bold;
        }

        .card-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .card-detail {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
        }

        .detail-label {
            font-size: 0.85rem;
            color: #666;
        }

        .detail-value {
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 5px;
        }

        .card-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* MODAL PARA VENDA DE ATIVOS */
        .asset-selection-modal {
            max-height: 60vh;
            overflow-y: auto;
        }

        .asset-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .asset-info {
            flex: 1;
        }

        .sell-checkbox {
            margin-left: 15px;
        }

        /* LOG */
        .log-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--secondary);
        }

        .log-content {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
        }

        .log-entry {
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85rem;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            color: var(--dark);
            border-radius: 15px;
            padding: 25px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .modal-title {
            color: var(--secondary);
            font-size: 1.4rem;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--danger);
        }

        /* INFORMA√á√ïES DO JOGADOR ATUAL (AGORA ABAIXO DA TABELA) */
        .player-info-below-table {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid var(--warning);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .player-info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .info-label {
            font-size: 0.8rem;
            color: #bdc3c7;
            margin-bottom: 3px;
            text-align: center;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: bold;
            text-align: center;
        }

        .info-income { color: var(--success); }
        .info-expense { color: var(--danger); }
        .info-warning { color: var(--warning); }
        .info-protection { color: var(--protection); }

        /* DEBT INDICATOR */
        .debt-indicator {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid var(--danger);
            border-radius: 20px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: var(--danger);
            grid-column: 1 / -1;
            justify-content: center;
        }

        /* RESPONSIVO */
        @media (max-width: 768px) {
            .board-table {
                font-size: 0.8rem;
            }
            
            .board-table th,
            .board-table td {
                padding: 6px;
            }
            
            .board-table td:first-child {
                width: 30px;
                min-width: 30px;
            }
            
            .space-number {
                width: 25px;
                font-size: 0.8rem;
            }
            
            .player-markers-cell {
                min-width: 120px;
            }
            
            .dice-container {
                gap: 10px;
            }
            
            .dice {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            .button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .player-info-below-table {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .debt-indicator {
                grid-column: 1;
            }
        }

        /* CORES DOS JOGADORES */
        .color-1 { background: var(--player1); }
        .color-2 { background: var(--player2); }
        .color-3 { background: var(--player3); }
        .color-4 { background: var(--player4); }
        .color-5 { background: var(--player5); }
        .color-6 { background: var(--player6); }

        /* ANIMA√á√ïES */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse-warning {
            animation: pulse 1s infinite;
        }

        /* GAME STATS */
        .game-stats {
            display: flex;
            justify-content: space-around;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            color: var(--warning);
            font-size: 1.1rem;
        }

        /* FAST TRACK (AGORA NO FINAL) */
        .fast-track-section {
            background: rgba(155, 89, 182, 0.3);
            border: 2px solid #9b59b6;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .fast-track-card {
            background: white;
            color: var(--dark);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 5px solid #9b59b6;
        }

        .fast-track-header {
            color: #9b59b6;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dream-achieved {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin: 5px 0;
        }

        /* PROFISS√ïES INFO */
        .professions-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.85rem;
        }

        .professions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .profession-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 5px;
            border-left: 3px solid var(--warning);
        }

        /* BOT√ÉO DE EMPR√âSTIMO */
        .button-loan {
            background: #9b59b6;
        }

        /* PROTE√á√ÉO FINANCEIRA */
        .protection-badge {
            background: var(--protection);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- TELA DE CONFIGURA√á√ÉO -->
        <div id="setupScreen" class="setup-screen">
            <h2 style="color: var(--warning); text-align: center; margin-bottom: 20px;">
                <i class="fas fa-cogs"></i> CONFIGURA√á√ÉO DO JOGO
            </h2>
            
            <div class="setup-form">
                <div class="form-group">
                    <label><i class="fas fa-users"></i> N√öMERO DE JOGADORES (2-6)</label>
                    <select id="numPlayers">
                        <option value="2">2 Jogadores</option>
                        <option value="3">3 Jogadores</option>
                        <option value="4">4 Jogadores</option>
                        <option value="5">5 Jogadores</option>
                        <option value="6">6 Jogadores</option>
                    </select>
                </div>
                
                <div id="playerNamesContainer" class="player-names-container">
                    <!-- Nomes ser√£o gerados aqui -->
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="button button-warning" id="startGameBtn" style="padding: 15px 40px; font-size: 1.1rem;">
                        <i class="fas fa-play"></i> INICIAR JOGO
                    </button>
                </div>
            </div>
        </div>

        <!-- √ÅREA DO JOGO (inicialmente escondida) -->
        <div id="gameArea" style="display: none;">
            <header style="text-align: center; margin-bottom: 20px;">
                <h1 style="color: var(--warning); font-size: 2rem;">
                    <i class="fas fa-coins"></i> CASHFLOW ONLINE - EDI√á√ÉO ORIGINAL
                </h1>
                <p style="color: var(--light);">Fiel ao jogo de tabuleiro original</p>
            </header>

            <!-- INFORMA√á√ïES DO JOGO -->
            <div class="game-stats">
                <div class="stat-item">
                    <div>Rodada Atual</div>
                    <div class="stat-value" id="currentRound">1</div>
                </div>
                <div class="stat-item">
                    <div>Status</div>
                    <div class="stat-value" id="gameStatus">CORRIDA DOS RATOS</div>
                </div>
                <div class="stat-item">
                    <div>Jogadores Fast Track</div>
                    <div class="stat-value" id="fastTrackCount">0</div>
                </div>
            </div>

            <!-- TABELA DO TABULEIRO -->
            <div class="board-table-container">
                <h3 style="color: var(--warning); margin-bottom: 15px; text-align: center;">
                    <i class="fas fa-table"></i> TABULEIRO - CORRIDA DOS RATOS
                </h3>
                <table class="board-table" id="boardTable">
                    <!-- Gerado dinamicamente -->
                </table>
            </div>

            <!-- INFORMA√á√ïES DO JOGADOR ATUAL (AGORA ABAIXO DA TABELA) -->
            <div class="player-info-below-table" id="currentPlayerInfo">
                <!-- Informa√ß√µes ser√£o inseridas aqui -->
            </div>

            <!-- CONTROLES -->
            <div class="controls">
                <h3 style="color: var(--warning); margin-bottom: 15px; text-align: center;">
                    <i class="fas fa-gamepad"></i> CONTROLES
                </h3>
                
                <div class="dice-container">
                    <div class="dice" id="dice1">?</div>
                    <div class="dice" id="dice2">?</div>
                    <div class="dice" id="dice3" style="display: none;">?</div>
                </div>
                
                <div>
                    <button class="button button-warning" id="rollDiceBtn">
                        <i class="fas fa-dice"></i> ROLAR DADOS
                    </button>
                    
                    <button class="button" id="endTurnBtn" disabled>
                        <i class="fas fa-forward"></i> FINALIZAR TURNO
                    </button>
                    
                    <button class="button button-success" id="showAssetsBtn">
                        <i class="fas fa-chart-pie"></i> MEUS ATIVOS
                    </button>
                    
                    <button class="button button-loan" id="takeLoanBtn">
                        <i class="fas fa-university"></i> PEGAR EMPR√âSTIMO
                    </button>
                    
                    <button class="button button-protection" id="useProtectionBtn" style="display: none;">
                        <i class="fas fa-shield-alt"></i> USAR PROTE√á√ÉO
                    </button>
                    
                    <button class="button button-purple" id="newGameBtn">
                        <i class="fas fa-redo"></i> NOVO JOGO
                    </button>
                </div>
                
                <div id="winnerMessage" style="margin-top: 15px;"></div>
            </div>

            <!-- √ÅREA DE CARTAS -->
            <div class="card-display" id="cardDisplay">
                <div class="card-header">
                    <div class="card-title" id="cardTitle">OPORTUNIDADE</div>
                    <div id="cardTypeTag" style="background: #3498db; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: bold;">
                        PEQUENA OPORTUNIDADE
                    </div>
                </div>
                
                <div id="cardDescription" style="margin-bottom: 15px;"></div>
                
                <div class="card-details" id="cardDetails">
                    <!-- Detalhes aqui -->
                </div>
                
                <div class="card-actions" id="cardActions">
                    <!-- Bot√µes aqui -->
                </div>
            </div>

            <!-- LOG DO JOGO -->
            <div class="log-section">
                <h3 style="color: var(--warning); margin-bottom: 15px; text-align: center;">
                    <i class="fas fa-history"></i> HIST√ìRICO DO JOGO
                </h3>
                <div class="log-content" id="gameLog">
                    <div class="log-entry">Jogo iniciado!</div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <button class="button" onclick="clearLog()" style="padding: 8px 15px;">
                        <i class="fas fa-trash"></i> Limpar Hist√≥rico
                    </button>
                </div>
            </div>

            <!-- INFORMA√á√ïES DAS PROFISS√ïES -->
            <div class="professions-info" id="professionsInfo">
                <h4 style="color: var(--warning); margin-bottom: 10px;">
                    <i class="fas fa-user-tie"></i> PROFISS√ïES DO JOGO
                </h4>
                <div class="professions-grid" id="professionsGrid">
                    <!-- Profiss√µes ser√£o inseridas aqui -->
                </div>
            </div>

            <!-- FAST TRACK SECTION (AGORA NO FINAL) -->
            <div class="fast-track-section" id="fastTrackSection">
                <h3 style="color: #9b59b6; margin-bottom: 15px; text-align: center;">
                    <i class="fas fa-bolt"></i> VIA R√ÅPIDA (FAST TRACK)
                </h3>
                <div id="fastTrackContent">
                    <!-- Conte√∫do da via r√°pida -->
                </div>
            </div>
        </div>

        <!-- MODAL DE ATIVOS -->
        <div class="modal" id="assetsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="assetsTitle">MEUS ATIVOS</div>
                    <button class="close-modal" onclick="closeModal('assetsModal')">&times;</button>
                </div>
                <div id="assetsContent">
                    <!-- Conte√∫do aqui -->
                </div>
            </div>
        </div>

        <!-- MODAL PARA VENDA DE IM√ìVEIS -->
        <div class="modal" id="sellAssetsModal">
            <div class="modal-content asset-selection-modal">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-home"></i> VENDER IM√ìVEIS</div>
                    <button class="close-modal" onclick="closeModal('sellAssetsModal')">&times;</button>
                </div>
                <div id="sellAssetsContent">
                    <!-- Lista de im√≥veis aqui -->
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="button button-success" onclick="confirmSellAssets()">
                        <i class="fas fa-check"></i> VENDER SELECIONADOS
                    </button>
                    <button class="button" onclick="closeModal('sellAssetsModal')">
                        <i class="fas fa-times"></i> CANCELAR
                    </button>
                </div>
            </div>
        </div>

        <!-- MODAL PARA VENDA DE A√á√ïES -->
        <div class="modal" id="sellStocksModal">
            <div class="modal-content asset-selection-modal">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-chart-line"></i> VENDER A√á√ïES</div>
                    <button class="close-modal" onclick="closeModal('sellStocksModal')">&times;</button>
                </div>
                <div id="sellStocksContent">
                    <!-- Lista de a√ß√µes aqui -->
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="button button-success" onclick="confirmSellStocks()">
                        <i class="fas fa-check"></i> VENDER SELECIONADOS
                    </button>
                    <button class="button" onclick="closeModal('sellStocksModal')">
                        <i class="fas fa-times"></i> CANCELAR
                    </button>
                </div>
            </div>
        </div>

        <!-- MODAL DE EMPR√âSTIMO -->
        <div class="modal" id="loanModal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title"><i class="fas fa-university"></i> PEGAR EMPR√âSTIMO</div>
                    <button class="close-modal" onclick="closeModal('loanModal')">&times;</button>
                </div>
                <div id="loanContent">
                    <!-- Conte√∫do aqui -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // =========== CONFIGURA√á√ÉO DO JOGO ===========
        const gameState = {
            currentPlayer: 1,
            gameActive: true,
            diceValue: 0,
            currentCard: null,
            totalPlayers: 2,
            players: {},
            spaces: [],
            dice3Enabled: false,
            charityPlayer: null,
            currentRound: 1,
            totalLaps: 0,
            marketEvent: null,
            availableProfessions: [],
            playerDreams: {},
            nextDoodadProtected: false,
            protectedPlayer: null
        };

        // =========== PROFISS√ïES DO JOGO ORIGINAL ===========
        const allProfessions = [
            {
                name: "Zelador (Janitor)",
                salary: 1600,
                initialCash: 400, // Ser√° sobrescrito pela nova regra
                perChildCost: 70,
                taxes: 280,
                mortgage: 300,
                carPayment: 100,
                creditCard: 60,
                otherExpenses: 190,
                studentLoan: 0
            },
            {
                name: "Caminhoneiro",
                salary: 2500,
                initialCash: 700,
                perChildCost: 140,
                taxes: 460,
                mortgage: 400,
                carPayment: 140,
                creditCard: 90,
                otherExpenses: 300,
                studentLoan: 0
            },
            {
                name: "Secret√°ria",
                salary: 2500,
                initialCash: 500,
                perChildCost: 120,
                taxes: 460,
                mortgage: 400,
                carPayment: 120,
                creditCard: 90,
                otherExpenses: 300,
                studentLoan: 0
            },
            {
                name: "Policial",
                salary: 3000,
                initialCash: 500,
                perChildCost: 160,
                taxes: 580,
                mortgage: 500,
                carPayment: 160,
                creditCard: 120,
                otherExpenses: 350,
                studentLoan: 0
            },
            {
                name: "Professor",
                salary: 3300,
                initialCash: 500,
                perChildCost: 110,
                taxes: 630,
                mortgage: 500,
                carPayment: 150,
                creditCard: 120,
                otherExpenses: 360,
                studentLoan: 180
            },
            {
                name: "Mec√¢nico",
                salary: 3300,
                initialCash: 700,
                perChildCost: 140,
                taxes: 630,
                mortgage: 500,
                carPayment: 200,
                creditCard: 120,
                otherExpenses: 360,
                studentLoan: 0
            },
            {
                name: "Enfermeiro",
                salary: 3600,
                initialCash: 600,
                perChildCost: 170,
                taxes: 700,
                mortgage: 600,
                carPayment: 200,
                creditCard: 140,
                otherExpenses: 380,
                studentLoan: 120
            },
            {
                name: "Gerente",
                salary: 4600,
                initialCash: 1000,
                perChildCost: 240,
                taxes: 910,
                mortgage: 900,
                carPayment: 300,
                creditCard: 220,
                otherExpenses: 500,
                studentLoan: 0
            },
            {
                name: "Engenheiro",
                salary: 4900,
                initialCash: 700,
                perChildCost: 250,
                taxes: 1050,
                mortgage: 750,
                carPayment: 300,
                creditCard: 220,
                otherExpenses: 550,
                studentLoan: 250
            },
            {
                name: "Advogado",
                salary: 7500,
                initialCash: 1000,
                perChildCost: 380,
                taxes: 1830,
                mortgage: 1100,
                carPayment: 300,
                creditCard: 220,
                otherExpenses: 630,
                studentLoan: 400
            },
            {
                name: "Piloto",
                salary: 9500,
                initialCash: 1000,
                perChildCost: 380,
                taxes: 2350,
                mortgage: 1300,
                carPayment: 400,
                creditCard: 300,
                otherExpenses: 750,
                studentLoan: 0
            },
            {
                name: "M√©dico",
                salary: 13000,
                initialCash: 1000,
                perChildCost: 640,
                taxes: 3400,
                mortgage: 1900,
                carPayment: 600,
                creditCard: 400,
                otherExpenses: 1000,
                studentLoan: 1000
            }
        ];

        // =========== SONHOS PARA CADA JOGADOR ===========
        const allDreams = [
            "Iate de Luxo",
            "Mans√£o na Praia",
            "Ferrari Vermelha",
            "Viagem ao Espa√ßo",
            "Ilha Particular",
            "Cole√ß√£o de Arte",
            "Helic√≥ptero Particular",
            "Time de Futebol",
            "Castelo na Europa",
            "Cruzeiro ao Redor do Mundo",
            "Fazenda de Cavalos",
            "Observat√≥rio Astron√¥mico"
        ];

        // =========== NOVAS CARTAS PEQUENAS OPORTUNIDADES (SMALL DEAL) - REBALANCEADAS ===========
        const smallDealCards = [
            {
                name: "LOANER - A√ß√µes a R$ 5 cada",
                type: "a√ß√µes",
                description: "Corretora de investimentos. Compra m√≠nima de 100 a√ß√µes.",
                costPerShare: 5,
                shares: 100,
                downPayment: 500,
                cashflow: 0,
                roi: "Venda por R$ 40 por a√ß√£o (somente em mercado)"
            },
            {
                name: "MYT4U - A√ß√µes a R$ 1 cada",
                type: "a√ß√µes",
                description: "Empresa de tecnologia. Oportunidade de alto crescimento.",
                costPerShare: 1,
                shares: 100,
                downPayment: 100,
                cashflow: 0,
                roi: "Venda por R$ 8,00 por a√ß√£o (50% por evento de mercado)"
            },
            {
                name: "ON2U - A√ß√µes a R$ 0,10 cada",
                type: "a√ß√µes",
                description: "Startup de internet. Risco alto, potencial alto.",
                costPerShare: 0.10,
                shares: 1000,
                downPayment: 100,
                cashflow: 0,
                roi: "Venda por R$ 1,50 por a√ß√£o (somente em mercado de alta)"
            },
            {
                name: "OK4U - A√ß√µes a R$ 10 cada",
                type: "a√ß√µes",
                description: "Empresa de telecomunica√ß√µes consolidada.",
                costPerShare: 10,
                shares: 100,
                downPayment: 1000,
                cashflow: 30
            },
            {
                name: "Previd√™ncia Privada",
                type: "t√≠tulos",
                description: "Plano de aposentadoria com retorno garantido.",
                cost: 5000,
                downPayment: 5000,
                cashflow: 200,
                roi: "20% ao ano"
            },
            {
                name: "Fundo Imobili√°rio",
                type: "fii",
                description: "Investimento em im√≥veis comerciais.",
                cost: 10000,
                downPayment: 10000,
                cashflow: 400,
                roi: "12% ao ano"
            },
            {
                name: "Seguro Contra Despesas",
                type: "prote√ß√£o",
                description: "Anula o pr√≥ximo Doodad que voc√™ cair. Uso √∫nico.",
                cost: 300,
                downPayment: 300,
                protection: true
            }
        ];

        // =========== NOVAS CARTAS GRANDES OPORTUNIDADES (BIG DEAL) - REBALANCEADAS ===========
        const bigDealCards = [
            {
                name: "Apartamento de 2 Quartos",
                type: "im√≥vel",
                description: "Apartamento para aluguel em √°rea urbana.",
                cost: 65000,
                downPayment: 13000,
                mortgage: 52000,
                cashflow: 90,
                roi: "10% ao ano"
            },
            {
                name: "Casa de 3 Quartos com Piscina",
                type: "im√≥vel",
                description: "Casa familiar em bairro nobre.",
                cost: 135000,
                downPayment: 27000,
                mortgage: 108000,
                cashflow: 500,
                roi: "15% ao ano"
            },
            {
                name: "Pr√©dio de 24 Apartamentos",
                type: "im√≥vel",
                description: "Edif√≠cio residencial com alta taxa de ocupa√ß√£o.",
                cost: 1200000,
                downPayment: 150000,
                mortgage: 1050000,
                cashflow: 3000,
                roi: "24% CCR",
                requires: "1 volta completa"
            },
            {
                name: "Shopping Center",
                type: "im√≥vel",
                description: "Complexo comercial com v√°rias lojas.",
                cost: 5000000,
                downPayment: 600000,
                mortgage: 4400000,
                cashflow: 18000,
                roi: "36% CCR",
                requires: "Renda passiva m√≠nima R$ 5.000/m√™s"
            },
            {
                name: "Franquia de Fast Food",
                type: "neg√≥cio",
                description: "Restaurante de rede conhecida.",
                cost: 250000,
                downPayment: 50000,
                mortgage: 200000,
                cashflow: 2000,
                roi: "48% CCR"
            },
            {
                name: "Empresa de Software",
                type: "neg√≥cio",
                description: "Startup de tecnologia com contrato governamental.",
                cost: 500000,
                downPayment: 100000,
                mortgage: 400000,
                cashflow: 3000,
                roi: "36% CCR",
                requires: "1 volta completa OU renda passiva R$ 2.000/m√™s"
            }
        ];

        // =========== CARTAS DOODAD ATUALIZADAS ===========
        const doodadCards = [
            {
                name: "Celular Novo",
                description: "Smartphone de √∫ltima gera√ß√£o com plano de dados.",
                cost: 800
            },
            {
                name: "TV 65'' 4K",
                description: "Televis√£o smart com sistema de som surround.",
                cost: 3500
            },
            {
                name: "F√©rias no Caribe",
                description: "Pacote all-inclusive para 2 pessoas por 10 dias.",
                cost: 10000
            },
            {
                name: "Carro Novo",
                description: "Ve√≠culo zero km com seguro e licenciamento.",
                cost: 45000
            },
            {
                name: "Reforma da Casa",
                description: "Reforma completa da cozinha e banheiro.",
                cost: 25000
            },
            {
                name: "Academia em Casa",
                description: "Equipamentos de academia completos.",
                cost: 15000
            },
            {
                name: "Jantar em Restaurante 5 Estrelas",
                description: "Jantar para 4 pessoas com vinho.",
                cost: 2000
            },
            {
                name: "Curso de Especializa√ß√£o",
                description: "Curso profissionalizante de 6 meses.",
                cost: 6000
            }
        ];

        // =========== CARTAS DE MERCADO ===========
        const marketCards = [
            {
                name: "IM√ìVEIS VALORIZARAM!",
                type: "alta",
                assetType: "im√≥vel",
                description: "Grande demanda por im√≥veis! Voc√™ pode vender seus im√≥veis por um bom pre√ßo.",
                modifier: 1.5
            },
            {
                name: "A√á√ïES EM ALTA!",
                type: "alta",
                assetType: "a√ß√µes",
                description: "O mercado de a√ß√µes est√° em alta! Voc√™ pode vender suas a√ß√µes com lucro.",
                modifier: 2.0
            },
            {
                name: "CRISE IMOBILI√ÅRIA",
                type: "baixa",
                assetType: "im√≥vel",
                description: "O mercado imobili√°rio est√° em crise. Os pre√ßos ca√≠ram significativamente.",
                modifier: 0.7
            },
            {
                name: "BOLSA EM QUEDA LIVRE",
                type: "baixa",
                assetType: "a√ß√µes",
                description: "Crise financeira global afetou o mercado de a√ß√µes.",
                modifier: 0.5
            },
            {
                name: "JUROS SUBIRAM",
                type: "baixa",
                assetType: "t√≠tulos",
                description: "Taxa de juros aumentou, afetando t√≠tulos de renda fixa.",
                modifier: 0.8
            }
        ];

        // =========== FAST TRACK CARDS ===========
        const fastTrackCards = [
            {
                id: "floresta",
                nome: "Compre uma Floresta",
                descricao: "500 hectares de floresta preservada para ecoturismo.",
                tipo: "gasto",
                custo: 125000
            },
            {
                id: "carnaval",
                nome: "Festival de Carnaval",
                descricao: "Patrocine um bloco de carnaval para 5.000 pessoas.",
                tipo: "gasto",
                custo: 62500
            },
            {
                id: "cabana_pesca",
                nome: "Cabana de Pesca Exclusiva",
                descricao: "Cabana privativa em lago particular com helic√≥ptero.",
                tipo: "gasto",
                custo: 50000
            },
            {
                id: "parque_nome",
                nome: "Parque com Seu Nome",
                descricao: "Parque p√∫blico nomeado em sua homenagem.",
                tipo: "gasto",
                custo: 112500
            },
            {
                id: "franquia_frango",
                nome: "Franquia Internacional de Frango",
                descricao: "Rede de fast-food com 50 unidades.",
                tipo: "investimento",
                entrada: 150000,
                ccr: 40
            },
            {
                id: "camisetas",
                nome: "Cadeia de Lojas de Camisetas",
                descricao: "100 lojas em shoppings centers.",
                tipo: "investimento",
                entrada: 125000,
                fluxo: 25000
            },
            {
                id: "80_apart",
                nome: "80 Apartamentos Classe A",
                descricao: "Condom√≠nio de luxo em √°rea nobre.",
                tipo: "investimento",
                entrada: 150000,
                ccr: 30
            },
            {
                id: "auditoria",
                nome: "Auditoria Fiscal Federal",
                descricao: "Multa por irregularidades cont√°beis.",
                tipo: "penalidade"
            },
            {
                id: "processo",
                nome: "Processo Judicial por Danos Morais",
                descricao: "A√ß√£o movida por ex-funcion√°rio.",
                tipo: "penalidade",
                custo: 50000
            }
        ];

        // =========== CONFIGURA√á√ÉO INICIAL ===========
        function initializeGame() {
            setupPlayerNames();
            
            document.getElementById('numPlayers').addEventListener('change', setupPlayerNames);
            document.getElementById('startGameBtn').addEventListener('click', startGame);
            document.getElementById('rollDiceBtn').addEventListener('click', rollDice);
            document.getElementById('endTurnBtn').addEventListener('click', endTurn);
            document.getElementById('showAssetsBtn').addEventListener('click', showAssets);
            document.getElementById('takeLoanBtn').addEventListener('click', showLoanModal);
            document.getElementById('useProtectionBtn').addEventListener('click', useProtection);
            document.getElementById('newGameBtn').addEventListener('click', () => location.reload());
            
            showProfessionsInfo();
        }

        function setupPlayerNames() {
            const numPlayers = parseInt(document.getElementById('numPlayers').value);
            const container = document.getElementById('playerNamesContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= numPlayers; i++) {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label>Jogador ${i}:</label>
                    <input type="text" id="playerName${i}" value="Jogador ${i}" placeholder="Nome do jogador">
                `;
                container.appendChild(div);
            }
        }

        function getRandomProfession() {
            if (gameState.availableProfessions.length === 0) {
                gameState.availableProfessions = [...allProfessions];
            }
            
            const randomIndex = Math.floor(Math.random() * gameState.availableProfessions.length);
            const profession = gameState.availableProfessions[randomIndex];
            
            gameState.availableProfessions.splice(randomIndex, 1);
            
            return profession;
        }

        function getRandomDreamForPlayer(playerId) {
            if (!gameState.playerDreams[playerId]) {
                const availableDreams = allDreams.filter(dream => 
                    !Object.values(gameState.playerDreams).includes(dream)
                );
                
                if (availableDreams.length === 0) {
                    gameState.playerDreams = {};
                    availableDreams = [...allDreams];
                }
                
                const randomDream = availableDreams[Math.floor(Math.random() * availableDreams.length)];
                gameState.playerDreams[playerId] = randomDream;
            }
            
            return gameState.playerDreams[playerId];
        }

        function startGame() {
            const numPlayers = parseInt(document.getElementById('numPlayers').value);
            gameState.totalPlayers = numPlayers;
            gameState.players = {};
            gameState.currentRound = 1;
            gameState.totalLaps = 0;
            gameState.availableProfessions = [...allProfessions];
            gameState.playerDreams = {};
            gameState.nextDoodadProtected = false;
            gameState.protectedPlayer = null;
            
            for (let i = 1; i <= numPlayers; i++) {
                const name = document.getElementById(`playerName${i}`).value || `Jogador ${i}`;
                const prof = getRandomProfession();
                const dream = getRandomDreamForPlayer(i);
                
                // Calcular despesas totais
                const totalExpenses = prof.taxes + prof.mortgage + prof.carPayment + 
                                    prof.creditCard + prof.otherExpenses + prof.studentLoan;
                
                // NOVA REGRA: Dinheiro Inicial = 2 √ó Despesas Mensais
                const initialCash = totalExpenses * 2;
                
                gameState.players[i] = {
                    id: i,
                    name: name,
                    profession: prof.name,
                    salary: prof.salary,
                    initialCash: initialCash, // Usando a nova regra
                    cash: initialCash,
                    passiveIncome: 0,
                    position: 0,
                    inRatRace: true,
                    children: 0,
                    maxChildren: 3,
                    perChildCost: prof.perChildCost,
                    expenses: totalExpenses,
                    cashflow: prof.salary - totalExpenses,
                    assets: {
                        stocks: [],
                        realEstate: [],
                        businesses: [],
                        bonds: [],
                        protection: null
                    },
                    loans: [],
                    liabilities: {
                        studentLoan: prof.studentLoan,
                        carLoan: prof.carPayment,
                        creditCard: prof.creditCard,
                        mortgage: prof.mortgage
                    },
                    hasCharityBonus: false,
                    lapsCompleted: 0,
                    dreams: [],
                    assignedDream: dream,
                    isDownsized: false, // Nova flag para demiss√£o
                    downsizedRounds: 0 // Contador de rodadas demitido
                };
            }
            
            createBoard();
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            
            updateBoard();
            updateCurrentPlayerInfo();
            updateGameStats();
            updateProtectionButton();
            
            addLog("üéÆ JOGO INICIADO - CASHFLOW ORIGINAL!");
            addLog("üí∞ NOVA REGRA: Dinheiro Inicial = 2 √ó Despesas Mensais");
            
            for (let i = 1; i <= numPlayers; i++) {
                const player = gameState.players[i];
                addLog(`üë§ ${player.name} √© ${player.profession} (Sal√°rio: R$ ${player.salary.toLocaleString()}, Inicial: R$ ${player.cash.toLocaleString()})`);
                addLog(`üí≠ Sonho de ${player.name}: ${player.assignedDream}`);
            }
            addLog(`üé≤ Vez de: ${gameState.players[1].name}`);
        }

        // =========== TABULEIRO ===========
        function createBoard() {
            gameState.spaces = [];
            
            const spaceTypes = [
                'start', 'opportunity', 'doodad', 'opportunity', 'market',
                'opportunity', 'payday', 'opportunity', 'downsized', 'opportunity',
                'doodad', 'opportunity', 'market', 'opportunity', 'payday',
                'opportunity', 'baby', 'opportunity', 'doodad', 'opportunity',
                'charity', 'opportunity', 'payday', 'opportunity', 'market'
            ];
            
            const spaceNames = [
                'IN√çCIO', 'OPORTUNIDADE', 'DOODADS', 'OPORTUNIDADE', 'MERCADO',
                'OPORTUNIDADE', 'DIA DE PAGAMENTO', 'OPORTUNIDADE', 'DEMISS√ÉO', 'OPORTUNIDADE',
                'DOODADS', 'OPORTUNIDADE', 'MERCADO', 'OPORTUNIDADE', 'DIA DE PAGAMENTO',
                'OPORTUNIDADE', 'BEB√ä', 'OPORTUNIDADE', 'DOODADS', 'OPORTUNIDADE',
                'CARIDADE', 'OPORTUNIDADE', 'DIA DE PAGAMENTO', 'OPORTUNIDADE', 'MERCADO'
            ];
            
            const spaceActions = [
                'Comece aqui!', 'Compre Small Deal ou Big Deal', 'Gasto obrigat√≥rio!', 'Compre Small Deal ou Big Deal', 'Venda ou compre ativos',
                'Compre Small Deal ou Big Deal', 'Receba sal√°rio + renda passiva', 'Compre Small Deal ou Big Deal', 'Pague 1 m√™s de despesas', 'Compre Small Deal ou Big Deal',
                'Gasto obrigat√≥rio!', 'Compre Small Deal ou Big Deal', 'Venda ou compre ativos', 'Compre Small Deal ou Big Deal', 'Receba sal√°rio + renda passiva',
                'Compre Small Deal ou Big Deal', 'Despesas aumentam', 'Compre Small Deal ou Big Deal', 'Gasto obrigat√≥rio!', 'Compre Small Deal ou Big Deal',
                'Doa√ß√£o 10% do sal√°rio', 'Compre Small Deal ou Big Deal', 'Receba sal√°rio + renda passiva', 'Compre Small Deal ou Big Deal', 'Venda ou compre ativos'
            ];
            
            for (let i = 0; i < 25; i++) {
                gameState.spaces.push({
                    num: i + 1,
                    type: spaceTypes[i],
                    name: spaceNames[i],
                    action: spaceActions[i]
                });
            }
            
            const table = document.getElementById('boardTable');
            let html = `
                <thead>
                    <tr>
                        <th>ESPA√áO</th>
                        <th>TIPO</th>
                        <th>A√á√ÉO</th>
                        <th>JOGADORES</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            for (let i = 0; i < 25; i++) {
                const space = gameState.spaces[i];
                html += `
                    <tr class="space-${space.type}">
                        <td><span class="space-number">${space.num}</span></td>
                        <td><span class="space-type">${space.name}</span></td>
                        <td><span class="space-action">${space.action}</span></td>
                        <td id="spaceMarkers${i}" class="player-markers-cell">
                            <div class="player-markers" id="markers${i}"></div>
                        </td>
                    </tr>
                `;
            }
            
            html += '</tbody>';
            table.innerHTML = html;
        }

        function updateBoard() {
            for (let i = 0; i < 25; i++) {
                const markersDiv = document.getElementById(`markers${i}`);
                if (markersDiv) markersDiv.innerHTML = '';
            }
            
            for (let playerId = 1; playerId <= gameState.totalPlayers; playerId++) {
                const player = gameState.players[playerId];
                
                if (!player.inRatRace) continue;
                
                const markersDiv = document.getElementById(`markers${player.position}`);
                
                if (markersDiv) {
                    const marker = document.createElement('div');
                    marker.className = `player-marker color-${playerId}`;
                    marker.textContent = playerId;
                    marker.title = player.name;
                    markersDiv.appendChild(marker);
                }
            }
            
            updateFastTrackSection();
        }

        // =========== MOSTRAR INFORMA√á√ïES DAS PROFISS√ïES ===========
        function showProfessionsInfo() {
            const container = document.getElementById('professionsGrid');
            let html = '';
            
            allProfessions.forEach(prof => {
                const totalExpenses = prof.taxes + prof.mortgage + prof.carPayment + 
                                    prof.creditCard + prof.otherExpenses + prof.studentLoan;
                const initialCashflow = prof.salary - totalExpenses;
                
                // Mostrar o c√°lculo com a nova regra
                const initialCashNewRule = totalExpenses * 2;
                
                html += `
                    <div class="profession-item">
                        <strong>${prof.name}</strong><br>
                        <small>Sal√°rio: R$ ${prof.salary.toLocaleString()}</small><br>
                        <small>Despesas: R$ ${totalExpenses.toLocaleString()}/m√™s</small><br>
                        <small>Inicial (2√ó): R$ ${initialCashNewRule.toLocaleString()}</small><br>
                        <small>Fluxo: R$ ${initialCashflow.toLocaleString()}/m√™s</small><br>
                        <small>Filho: R$ ${prof.perChildCost}/m√™s</small>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // =========== ATUALIZAR FAST TRACK SECTION ===========
        function updateFastTrackSection() {
            const section = document.getElementById('fastTrackSection');
            const content = document.getElementById('fastTrackContent');
            
            let fastTrackPlayers = [];
            for (let playerId = 1; playerId <= gameState.totalPlayers; playerId++) {
                if (!gameState.players[playerId].inRatRace) {
                    fastTrackPlayers.push(gameState.players[playerId]);
                }
            }
            
            if (fastTrackPlayers.length > 0) {
                section.style.display = 'block';
                
                let html = '';
                fastTrackPlayers.forEach(player => {
                    html += `
                        <div class="fast-track-card">
                            <div class="fast-track-header">
                                <span>${player.name}</span>
                                <span style="color: #2ecc71;">R$ ${player.passiveIncome.toLocaleString()}/m√™s</span>
                            </div>
                            <p>Saldo: R$ ${player.cash.toLocaleString()}</p>
                            <p><strong>Sonho:</strong> ${player.assignedDream}</p>
                            ${player.dreams.length > 0 ? `
                                <div style="margin-top: 10px;">
                                    <strong>Sonhos Realizados:</strong>
                                    ${player.dreams.map(dream => `
                                        <div class="dream-achieved">${dream}</div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                content.innerHTML = html;
            } else {
                section.style.display = 'none';
            }
            
            document.getElementById('fastTrackCount').textContent = fastTrackPlayers.length;
        }

        // =========== ATUALIZAR ESTAT√çSTICAS DO JOGO ===========
        function updateGameStats() {
            document.getElementById('currentRound').textContent = gameState.currentRound;
            
            let fastTrackCount = 0;
            for (let playerId = 1; playerId <= gameState.totalPlayers; playerId++) {
                if (!gameState.players[playerId].inRatRace) {
                    fastTrackCount++;
                }
            }
            
            document.getElementById('fastTrackCount').textContent = fastTrackCount;
            
            if (fastTrackCount === gameState.totalPlayers) {
                document.getElementById('gameStatus').textContent = "TODOS NO FAST TRACK";
                document.getElementById('gameStatus').style.color = "#9b59b6";
            } else if (fastTrackCount > 0) {
                document.getElementById('gameStatus').textContent = "FAST TRACK ATIVO";
                document.getElementById('gameStatus').style.color = "#9b59b6";
            } else {
                document.getElementById('gameStatus').textContent = "CORRIDA DOS RATOS";
                document.getElementById('gameStatus').style.color = "#f39c12";
            }
        }

        // =========== ATUALIZAR INFORMA√á√ïES DO JOGADOR ===========
        function updateCurrentPlayerInfo() {
            const player = gameState.players[gameState.currentPlayer];
            const infoBar = document.getElementById('currentPlayerInfo');
            
            const childExpenses = player.children * player.perChildCost;
            const totalExpenses = player.expenses + childExpenses;
            
            let totalLoans = 0;
            player.loans.forEach(loan => {
                totalLoans += loan.amount;
            });
            
            let html = `
                <div class="player-info-item">
                    <div class="info-label">JOGADOR ATUAL</div>
                    <div class="info-value" style="color: var(--player${player.id})">
                        ${player.name}
                    </div>
                </div>
                
                <div class="player-info-item">
                    <div class="info-label">PROFISS√ÉO</div>
                    <div class="info-value">${player.profession}</div>
                </div>
                
                <div class="player-info-item">
                    <div class="info-label">DINHEIRO</div>
                    <div class="info-value info-income">R$ ${player.cash.toLocaleString()}</div>
                </div>
                
                <div class="player-info-item">
                    <div class="info-label">RENDA PASSIVA</div>
                    <div class="info-value info-income">R$ ${player.passiveIncome.toLocaleString()}/m√™s</div>
                </div>
                
                <div class="player-info-item">
                    <div class="info-label">DESPESAS TOTAIS</div>
                    <div class="info-value info-expense">R$ ${totalExpenses.toLocaleString()}/m√™s</div>
                </div>
                
                <div class="player-info-item">
                    <div class="info-label">FLUXO DE CAIXA</div>
                    <div class="info-value" style="color: ${player.salary + player.passiveIncome - totalExpenses >= 0 ? '#2ecc71' : '#e74c3c'}">
                        R$ ${(player.salary + player.passiveIncome - totalExpenses).toLocaleString()}/m√™s
                    </div>
                </div>
            `;
            
            if (player.children > 0) {
                html += `
                    <div class="player-info-item">
                        <div class="info-label">FILHOS</div>
                        <div class="info-value">${player.children} (R$ ${childExpenses}/m√™s)</div>
                    </div>
                `;
            }
            
            if (totalLoans > 0) {
                html += `
                    <div class="player-info-item">
                        <div class="info-label">EMPR√âSTIMOS</div>
                        <div class="info-value info-warning">R$ ${totalLoans.toLocaleString()}</div>
                    </div>
                `;
            }
            
            if (player.assets.protection) {
                html += `
                    <div class="player-info-item">
                        <div class="info-label">PROTE√á√ÉO</div>
                        <div class="info-value info-protection">
                            <i class="fas fa-shield-alt"></i> ATIVA
                        </div>
                    </div>
                `;
            }
            
            if (player.isDownsized) {
                html += `
                    <div class="player-info-item" style="grid-column: 1 / -1;">
                        <div class="info-value info-warning">
                            <i class="fas fa-exclamation-triangle"></i> DEMITIDO (${player.downsizedRounds}/2 rodadas)
                        </div>
                    </div>
                `;
            }
            
            if (!player.inRatRace) {
                html += `
                    <div class="player-info-item" style="grid-column: 1 / -1;">
                        <div class="info-value" style="color: #9b59b6;">
                            üöÄ VIA R√ÅPIDA (FAST TRACK)
                        </div>
                    </div>
                    <div class="player-info-item" style="grid-column: 1 / -1;">
                        <div class="info-label">SONHO</div>
                        <div class="info-value" style="color: #f39c12;">${player.assignedDream}</div>
                    </div>
                `;
            }
            
            infoBar.innerHTML = html;
        }

        // =========== ATUALIZAR BOT√ÉO DE PROTE√á√ÉO ===========
        function updateProtectionButton() {
            const player = gameState.players[gameState.currentPlayer];
            const protectionBtn = document.getElementById('useProtectionBtn');
            
            if (player.assets.protection) {
                protectionBtn.style.display = 'inline-flex';
                protectionBtn.disabled = false;
                protectionBtn.innerHTML = '<i class="fas fa-shield-alt"></i> USAR PROTE√á√ÉO';
            } else {
                protectionBtn.style.display = 'none';
            }
        }

        // =========== USAR PROTE√á√ÉO ===========
        function useProtection() {
            const player = gameState.players[gameState.currentPlayer];
            
            if (!player.assets.protection) {
                alert("Voc√™ n√£o possui prote√ß√£o!");
                return;
            }
            
            gameState.nextDoodadProtected = true;
            gameState.protectedPlayer = player.id;
            
            player.assets.protection = null;
            
            addLog(`üõ°Ô∏è ${player.name} ativou prote√ß√£o! Pr√≥ximo Doodad ser√° anulado.`);
            
            updateProtectionButton();
            updateCurrentPlayerInfo();
            
            document.getElementById('useProtectionBtn').style.display = 'none';
        }

        // =========== SISTEMA DE EMPR√âSTIMOS ===========
        function showLoanModal() {
            const player = gameState.players[gameState.currentPlayer];
            
            let html = `
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--dark); margin-bottom: 10px;">Solicitar Empr√©stimo</h3>
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                            <span style="color: #666;">Saldo Dispon√≠vel:</span>
                            <span style="font-weight: bold; color: var(--dark);">R$ ${player.cash.toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                            <span style="color: #666;">Total de Empr√©stimos:</span>
                            <span style="font-weight: bold; color: #e74c3c;">R$ ${player.loans.reduce((sum, loan) => sum + loan.amount, 0).toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                            <span style="color: #666;">Juros do Banco:</span>
                            <span style="font-weight: bold; color: #e74c3c;">10% ao m√™s</span>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: var(--dark); margin-bottom: 15px;">Valores Dispon√≠veis:</h3>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
            `;
            
            const loanAmounts = [1000, 5000, 10000, 20000, 50000, 100000];
            
            loanAmounts.forEach(amount => {
                const monthlyPayment = amount * 0.1;
                html += `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; cursor: pointer;" 
                         onclick="takeLoan(${amount})">
                        <div style="font-weight: bold; font-size: 1.2rem; color: var(--dark);">
                            R$ ${amount.toLocaleString()}
                        </div>
                        <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">
                            Pagamento: R$ ${monthlyPayment.toLocaleString()}/m√™s
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                
                <div style="text-align: center; padding: 15px; background: #e74c3c10; border-radius: 8px; margin-top: 20px;">
                    <p style="color: #666; font-size: 0.9rem;">
                        <i class="fas fa-exclamation-triangle"></i> Aten√ß√£o: Os empr√©stimos t√™m juros de 10% ao m√™s. 
                        O pagamento √© deduzido automaticamente no Dia de Pagamento.
                    </p>
                </div>
            `;
            
            document.getElementById('loanContent').innerHTML = html;
            document.getElementById('loanModal').style.display = 'flex';
        }

        function takeLoan(amount) {
            const player = gameState.players[gameState.currentPlayer];
            
            player.loans.push({
                amount: amount,
                interestRate: 0.1,
                monthlyPayment: amount * 0.1,
                takenAt: Date.now()
            });
            
            player.cash += amount;
            player.expenses += amount * 0.1;
            player.cashflow = player.salary + player.passiveIncome - player.expenses;
            
            addLog(`üè¶ ${player.name} pegou empr√©stimo de R$ ${amount.toLocaleString()} (pagamento: R$ ${(amount * 0.1).toLocaleString()}/m√™s)`);
            
            closeModal('loanModal');
            updateCurrentPlayerInfo();
        }

        // =========== SISTEMA DE DADOS ===========
        function rollDice() {
            if (!gameState.gameActive) {
                alert("O jogo n√£o est√° ativo!");
                return;
            }
            
            const player = gameState.players[gameState.currentPlayer];
            
            if (!player.inRatRace) {
                showFastTrackOpportunity();
                return;
            }
            
            const rollBtn = document.getElementById('rollDiceBtn');
            rollBtn.disabled = true;
            
            const dice1 = document.getElementById('dice1');
            const dice2 = document.getElementById('dice2');
            const dice3 = document.getElementById('dice3');
            
            dice1.classList.add('rolling');
            dice2.classList.add('rolling');
            
            dice3.style.display = 'none';
            
            setTimeout(() => {
                const dice1Value = Math.floor(Math.random() * 6) + 1;
                const dice2Value = Math.floor(Math.random() * 6) + 1;
                
                let total = dice1Value + dice2Value;
                
                if (gameState.dice3Enabled && gameState.charityPlayer === gameState.currentPlayer) {
                    dice3.style.display = 'flex';
                    dice3.classList.add('rolling');
                    
                    setTimeout(() => {
                        const dice3Value = Math.floor(Math.random() * 6) + 1;
                        dice3.textContent = dice3Value;
                        dice3.classList.remove('rolling');
                        
                        const diceValues = [dice1Value, dice2Value, dice3Value];
                        diceValues.sort((a, b) => b - a);
                        total = diceValues[0] + diceValues[1];
                        
                        addLog(`üé≤ ${player.name} rolou 3 dados: ${dice1Value}, ${dice2Value}, ${dice3Value} ‚Üí usando ${diceValues[0]}+${diceValues[1]}=${total}`);
                        
                        gameState.dice3Enabled = false;
                        gameState.charityPlayer = null;
                        
                        dice1.textContent = dice1Value;
                        dice2.textContent = dice2Value;
                        dice1.classList.remove('rolling');
                        dice2.classList.remove('rolling');
                        
                        movePlayer(gameState.currentPlayer, total);
                        document.getElementById('endTurnBtn').disabled = false;
                    }, 800);
                } else {
                    addLog(`üé≤ ${player.name} rolou ${dice1Value}+${dice2Value}=${total}`);
                    
                    dice1.textContent = dice1Value;
                    dice2.textContent = dice2Value;
                    dice1.classList.remove('rolling');
                    dice2.classList.remove('rolling');
                    
                    movePlayer(gameState.currentPlayer, total);
                    document.getElementById('endTurnBtn').disabled = false;
                }
                
            }, 800);
        }

        function movePlayer(playerId, steps) {
            const player = gameState.players[playerId];
            const oldPosition = player.position;
            
            let newPosition = (player.position + steps) % 25;
            
            if (newPosition < oldPosition && steps > 0) {
                player.lapsCompleted++;
                gameState.totalLaps = Math.max(gameState.totalLaps, player.lapsCompleted);
                
                payday(playerId);
                
                addLog(`üîÑ ${player.name} completou uma volta! Total: ${player.lapsCompleted} volta(s)`);
            }
            
            player.position = newPosition;
            updateBoard();
            updateCurrentPlayerInfo();
            updateGameStats();
            activateSpace(playerId, newPosition);
        }

        // =========== ATIVA√á√ÉO DE ESPA√áOS ===========
        function activateSpace(playerId, position) {
            const player = gameState.players[playerId];
            const space = gameState.spaces[position];
            
            document.getElementById('cardDisplay').style.display = 'none';
            
            addLog(`üìç ${player.name} est√° no espa√ßo ${space.num}: ${space.name}`);
            
            setTimeout(() => {
                switch(space.type) {
                    case 'payday':
                        payday(playerId);
                        break;
                    case 'baby':
                        haveBaby(playerId);
                        break;
                    case 'charity':
                        charity(playerId);
                        break;
                    case 'downsized':
                        downsized(playerId);
                        break;
                    case 'opportunity':
                        // 70% Small Deal, 30% Big Deal
                        const isSmallDeal = Math.random() < 0.7;
                        if (isSmallDeal) {
                            showSmallDeal(playerId);
                        } else {
                            showBigDeal(playerId);
                        }
                        break;
                    case 'doodad':
                        showDoodadCard(playerId);
                        break;
                    case 'market':
                        showMarketCard(playerId);
                        break;
                }
            }, 500);
        }

        // =========== OPORTUNIDADES ALEAT√ìRIAS ===========
        function showSmallDeal(playerId) {
            const card = smallDealCards[Math.floor(Math.random() * smallDealCards.length)];
            gameState.currentCard = { ...card, playerId: playerId, cardType: 'small' };
            
            const display = document.getElementById('cardDisplay');
            const title = document.getElementById('cardTitle');
            const typeTag = document.getElementById('cardTypeTag');
            const description = document.getElementById('cardDescription');
            const details = document.getElementById('cardDetails');
            const actions = document.getElementById('cardActions');
            
            title.textContent = card.name;
            typeTag.textContent = 'PEQUENA OPORTUNIDADE';
            typeTag.style.backgroundColor = '#3498db';
            description.textContent = card.description;
            
            if (card.type === 'prote√ß√£o') {
                details.innerHTML = `
                    <div class="card-detail">
                        <div class="detail-label">Tipo</div>
                        <div class="detail-value">Prote√ß√£o Financeira</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Efeito</div>
                        <div class="detail-value">Anula o pr√≥ximo Doodad</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Custo</div>
                        <div class="detail-value">R$ ${card.cost.toLocaleString()}</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Dura√ß√£o</div>
                        <div class="detail-value">Uso √∫nico</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Regra</div>
                        <div class="detail-value">M√°ximo 1 por jogador</div>
                    </div>
                `;
                
                actions.innerHTML = `
                    <button class="button button-protection" onclick="buyAsset()">
                        <i class="fas fa-shield-alt"></i> COMPRAR PROTE√á√ÉO
                    </button>
                    <button class="button" onclick="declineCard()">
                        <i class="fas fa-times"></i> RECUSAR
                    </button>
                `;
                
            } else if (card.type === 'a√ß√µes') {
                details.innerHTML = `
                    <div class="card-detail">
                        <div class="detail-label">Tipo</div>
                        <div class="detail-value">A√ß√µes</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Pre√ßo por A√ß√£o</div>
                        <div class="detail-value">R$ ${card.costPerShare.toLocaleString()}</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Quantidade M√≠nima</div>
                        <div class="detail-value">${card.shares} a√ß√µes</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Investimento M√≠nimo</div>
                        <div class="detail-value">R$ ${card.downPayment.toLocaleString()}</div>
                    </div>
                    ${card.cashflow > 0 ? `
                    <div class="card-detail">
                        <div class="detail-label">Dividendo Mensal</div>
                        <div class="detail-value" style="color: #2ecc71;">R$ ${card.cashflow}</div>
                    </div>
                    ` : ''}
                    ${card.roi ? `
                    <div class="card-detail">
                        <div class="detail-label">Potencial de Venda</div>
                        <div class="detail-value" style="color: #f39c12;">${card.roi}</div>
                    </div>
                    ` : ''}
                `;
                
                actions.innerHTML = `
                    <button class="button button-success" onclick="buyAsset()">
                        <i class="fas fa-check"></i> COMPRAR
                    </button>
                    <button class="button" onclick="declineCard()">
                        <i class="fas fa-times"></i> RECUSAR
                    </button>
                `;
            } else {
                details.innerHTML = `
                    <div class="card-detail">
                        <div class="detail-label">Tipo</div>
                        <div class="detail-value">${card.type === 't√≠tulos' ? 'T√≠tulos' : 'Fundo Imobili√°rio'}</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Investimento M√≠nimo</div>
                        <div class="detail-value">R$ ${card.downPayment.toLocaleString()}</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Renda Mensal</div>
                        <div class="detail-value" style="color: #2ecc71;">R$ ${card.cashflow}</div>
                    </div>
                    ${card.roi ? `
                    <div class="card-detail">
                        <div class="detail-label">Retorno Anual</div>
                        <div class="detail-value" style="color: #f39c12;">${card.roi}</div>
                    </div>
                    ` : ''}
                `;
                
                actions.innerHTML = `
                    <button class="button button-success" onclick="buyAsset()">
                        <i class="fas fa-check"></i> COMPRAR
                    </button>
                    <button class="button" onclick="declineCard()">
                        <i class="fas fa-times"></i> RECUSAR
                    </button>
                `;
            }
            
            display.style.display = 'block';
        }

        function showBigDeal(playerId) {
            const player = gameState.players[playerId];
            let availableCards = [...bigDealCards];
            
            availableCards = availableCards.filter(card => {
                if (!card.requires) return true;
                
                if (card.requires === "1 volta completa") {
                    return player.lapsCompleted >= 1;
                }
                
                if (card.requires.includes("renda passiva m√≠nima")) {
                    const minIncome = parseInt(card.requires.match(/R\$ (\d+)/)[1]);
                    return player.passiveIncome >= minIncome;
                }
                
                if (card.requires.includes("OU")) {
                    const conditions = card.requires.split(" OU ");
                    return conditions.some(condition => {
                        if (condition === "1 volta completa") {
                            return player.lapsCompleted >= 1;
                        }
                        if (condition.includes("renda passiva m√≠nima")) {
                            const minIncome = parseInt(condition.match(/R\$ (\d+)/)[1]);
                            return player.passiveIncome >= minIncome;
                        }
                        return false;
                    });
                }
                
                return true;
            });
            
            if (availableCards.length === 0) {
                showSmallDeal(playerId);
                return;
            }
            
            const card = availableCards[Math.floor(Math.random() * availableCards.length)];
            gameState.currentCard = { ...card, playerId: playerId, cardType: 'big' };
            
            const display = document.getElementById('cardDisplay');
            const title = document.getElementById('cardTitle');
            const typeTag = document.getElementById('cardTypeTag');
            const description = document.getElementById('cardDescription');
            const details = document.getElementById('cardDetails');
            const actions = document.getElementById('cardActions');
            
            title.textContent = card.name;
            typeTag.textContent = 'GRANDE OPORTUNIDADE';
            typeTag.style.backgroundColor = '#e67e22';
            description.textContent = card.description;
            
            details.innerHTML = `
                <div class="card-detail">
                    <div class="detail-label">Tipo</div>
                    <div class="detail-value">${card.type === 'im√≥vel' ? 'Im√≥vel' : 'Neg√≥cio'}</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Valor Total</div>
                    <div class="detail-value">R$ ${card.cost.toLocaleString()}</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Entrada Necess√°ria</div>
                    <div class="detail-value">R$ ${card.downPayment.toLocaleString()}</div>
                </div>
                ${card.mortgage ? `
                <div class="card-detail">
                    <div class="detail-label">Financiamento</div>
                    <div class="detail-value">R$ ${card.mortgage.toLocaleString()}</div>
                </div>
                ` : ''}
                <div class="card-detail">
                    <div class="detail-label">Renda Mensal</div>
                    <div class="detail-value" style="color: #2ecc71;">R$ ${card.cashflow}</div>
                </div>
                ${card.roi ? `
                <div class="card-detail">
                    <div class="detail-label">Retorno</div>
                    <div class="detail-value" style="color: #f39c12;">${card.roi}</div>
                </div>
                ` : ''}
                ${card.requires ? `
                <div class="card-detail">
                    <div class="detail-label">Pr√©-requisito</div>
                    <div class="detail-value" style="color: #3498db;">${card.requires}</div>
                </div>
                ` : ''}
            `;
            
            actions.innerHTML = `
                <button class="button button-success" onclick="buyAsset()">
                    <i class="fas fa-check"></i> COMPRAR
                </button>
                <button class="button" onclick="declineCard()">
                    <i class="fas fa-times"></i> RECUSAR
                </button>
            `;
            
            display.style.display = 'block';
        }

        // =========== COMPRAR ATIVOS ===========
        function buyAsset() {
            const card = gameState.currentCard;
            const player = gameState.players[card.playerId];
            
            if (player.cash < card.downPayment) {
                if (confirm(`Dinheiro insuficiente! Voc√™ tem R$ ${player.cash.toLocaleString()}, precisa de R$ ${card.downPayment.toLocaleString()}.\n\nDeseja pegar um empr√©stimo?`)) {
                    showLoanModal();
                }
                return;
            }
            
            player.cash -= card.downPayment;
            
            if (card.type === 'prote√ß√£o') {
                if (player.assets.protection) {
                    alert("Voc√™ j√° possui uma prote√ß√£o ativa! M√°ximo 1 por jogador.");
                    player.cash += card.downPayment;
                    return;
                }
                
                player.assets.protection = {
                    name: card.name,
                    description: card.description,
                    active: true
                };
                
                addLog(`üõ°Ô∏è ${player.name} comprou ${card.name} por R$ ${card.downPayment.toLocaleString()}`);
                updateProtectionButton();
                
            } else if (card.type === 'a√ß√µes') {
                player.passiveIncome += card.cashflow || 0;
                
                let specialRules = "";
                if (card.name.includes("ON2U")) {
                    specialRules = "Venda somente em mercado de a√ß√µes | Risco: perde 50% em baixa";
                } else if (card.name.includes("MYT4U")) {
                    specialRules = "Venda limitada a 50% por evento de mercado";
                }
                
                player.assets.stocks.push({
                    name: card.name,
                    shares: card.shares,
                    costPerShare: card.costPerShare,
                    cashflow: card.cashflow || 0,
                    roi: card.roi || "",
                    specialRules: specialRules,
                    purchasePrice: card.downPayment,
                    canSell: false
                });
                
                addLog(`‚úÖ ${player.name} comprou ${card.name} por R$ ${card.downPayment.toLocaleString()} ${card.cashflow ? `(renda: +R$ ${card.cashflow}/m√™s)` : ''}`);
                
            } else if (card.type === 'im√≥vel') {
                player.passiveIncome += card.cashflow || 0;
                player.assets.realEstate.push({
                    name: card.name,
                    cost: card.cost,
                    downPayment: card.downPayment,
                    mortgage: card.mortgage || 0,
                    cashflow: card.cashflow || 0,
                    roi: card.roi || ""
                });
                
                addLog(`‚úÖ ${player.name} comprou ${card.name} por R$ ${card.downPayment.toLocaleString()} (renda: +R$ ${card.cashflow}/m√™s)`);
                
            } else if (card.type === 'neg√≥cio') {
                player.passiveIncome += card.cashflow || 0;
                player.assets.businesses.push({
                    name: card.name,
                    cost: card.cost,
                    downPayment: card.downPayment,
                    mortgage: card.mortgage || 0,
                    cashflow: card.cashflow || 0,
                    roi: card.roi || ""
                });
                
                addLog(`‚úÖ ${player.name} comprou ${card.name} por R$ ${card.downPayment.toLocaleString()} (renda: +R$ ${card.cashflow}/m√™s)`);
                
            } else if (card.type === 't√≠tulos' || card.type === 'fii') {
                player.passiveIncome += card.cashflow || 0;
                player.assets.bonds.push({
                    name: card.name,
                    cost: card.cost || card.downPayment,
                    cashflow: card.cashflow || 0,
                    roi: card.roi || ""
                });
                
                addLog(`‚úÖ ${player.name} comprou ${card.name} por R$ ${card.downPayment.toLocaleString()} (renda: +R$ ${card.cashflow}/m√™s)`);
            }
            
            checkExitRatRace(card.playerId);
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
        }

        // =========== DOODADS COM PROTE√á√ÉO ===========
        function showDoodadCard(playerId) {
            const player = gameState.players[playerId];
            
            if (gameState.nextDoodadProtected && gameState.protectedPlayer === playerId) {
                addLog(`üõ°Ô∏è ${player.name} usou prote√ß√£o! Doodad anulado.`);
                gameState.nextDoodadProtected = false;
                gameState.protectedPlayer = null;
                return;
            }
            
            const card = doodadCards[Math.floor(Math.random() * doodadCards.length)];
            gameState.currentCard = { ...card, playerId: playerId, cardType: 'doodad' };
            
            const display = document.getElementById('cardDisplay');
            const title = document.getElementById('cardTitle');
            const typeTag = document.getElementById('cardTypeTag');
            const description = document.getElementById('cardDescription');
            const details = document.getElementById('cardDetails');
            const actions = document.getElementById('cardActions');
            
            title.textContent = card.name;
            typeTag.textContent = 'DOODAD';
            typeTag.style.backgroundColor = '#e74c3c';
            description.textContent = card.description;
            
            details.innerHTML = `
                <div class="card-detail">
                    <div class="detail-label">Tipo</div>
                    <div class="detail-label">Despesa Obrigat√≥ria</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Custo</div>
                    <div class="detail-value" style="color: #e74c3c;">R$ ${card.cost.toLocaleString()}</div>
                </div>
            `;
            
            actions.innerHTML = `
                <button class="button button-danger" onclick="payDoodad()">
                    <i class="fas fa-check"></i> PAGAR
                </button>
            `;
            
            display.style.display = 'block';
        }

        function payDoodad() {
            const card = gameState.currentCard;
            const player = gameState.players[card.playerId];
            
            if (player.cash >= card.cost) {
                player.cash -= card.cost;
                addLog(`üí∏ ${player.name} pagou R$ ${card.cost.toLocaleString()} por ${card.name}`);
            } else {
                if (confirm(`Dinheiro insuficiente! Voc√™ precisa de R$ ${card.cost.toLocaleString()}.\n\nDeseja pegar um empr√©stimo?`)) {
                    showLoanModal();
                }
                return;
            }
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
        }

        // =========== MERCADO COM REGRAS ESPECIAIS ===========
        function showMarketCard(playerId) {
            const card = marketCards[Math.floor(Math.random() * marketCards.length)];
            gameState.currentCard = { ...card, playerId: playerId, cardType: 'market' };
            gameState.marketEvent = card;
            
            const display = document.getElementById('cardDisplay');
            const title = document.getElementById('cardTitle');
            const typeTag = document.getElementById('cardTypeTag');
            const description = document.getElementById('cardDescription');
            const details = document.getElementById('cardDetails');
            const actions = document.getElementById('cardActions');
            
            title.textContent = card.name;
            typeTag.textContent = 'MERCADO';
            typeTag.style.backgroundColor = card.type === 'alta' ? '#2ecc71' : '#e74c3c';
            description.textContent = card.description;
            
            const variation = ((card.modifier - 1) * 100).toFixed(0);
            
            details.innerHTML = `
                <div class="card-detail">
                    <div class="detail-label">Tipo de Mercado</div>
                    <div class="detail-value" style="color: ${card.type === 'alta' ? '#2ecc71' : '#e74c3c'}">
                        ${card.type === 'alta' ? 'ALTA' : 'BAIXA'}
                    </div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Afeta</div>
                    <div class="detail-value">${card.assetType === 'im√≥vel' ? 'IM√ìVEIS' : card.assetType === 'a√ß√µes' ? 'A√á√ïES' : 'T√çTULOS'}</div>
                </div>
                <div class="card-detail">
                    <div class="detail-label">Varia√ß√£o de Pre√ßo</div>
                    <div class="detail-value" style="color: ${card.modifier > 1 ? '#2ecc71' : '#e74c3c'}">
                        ${variation > 0 ? '+' : ''}${variation}%
                    </div>
                </div>
            `;
            
            if (card.type === 'alta') {
                if (card.assetType === 'im√≥vel') {
                    actions.innerHTML = `
                        <button class="button button-success" onclick="showSellRealEstateModal(${playerId})">
                            <i class="fas fa-home"></i> VENDER IM√ìVEIS
                        </button>
                        <button class="button" onclick="declineCard()">
                            <i class="fas fa-times"></i> MANTER ATIVOS
                        </button>
                    `;
                } else if (card.assetType === 'a√ß√µes') {
                    actions.innerHTML = `
                        <button class="button button-success" onclick="showSellStocksModal(${playerId})">
                            <i class="fas fa-chart-line"></i> VENDER A√á√ïES
                        </button>
                        <button class="button" onclick="declineCard()">
                            <i class="fas fa-times"></i> MANTER ATIVOS
                        </button>
                    `;
                } else {
                    actions.innerHTML = `
                        <button class="button" onclick="declineCard()">
                            <i class="fas fa-check"></i> ENTENDI
                        </button>
                    `;
                }
            } else {
                if (card.assetType === 'a√ß√µes') {
                    const player = gameState.players[playerId];
                    let lostStocks = false;
                    
                    player.assets.stocks.forEach(stock => {
                        if (stock.name.includes("ON2U")) {
                            const lostShares = Math.floor(stock.shares * 0.5);
                            if (lostShares > 0) {
                                stock.shares -= lostShares;
                                lostStocks = true;
                                addLog(`üìâ ${player.name} perdeu ${lostShares} a√ß√µes ON2U em queda do mercado`);
                            }
                        }
                    });
                    
                    if (lostStocks) {
                        actions.innerHTML = `
                            <button class="button button-danger" onclick="declineCard()">
                                <i class="fas fa-exclamation-triangle"></i> ACEITAR PERDAS
                            </button>
                        `;
                    } else {
                        actions.innerHTML = `
                            <button class="button" onclick="declineCard()">
                                <i class="fas fa-check"></i> ENTENDI
                            </button>
                        `;
                    }
                } else {
                    actions.innerHTML = `
                        <button class="button" onclick="declineCard()">
                            <i class="fas fa-check"></i> ENTENDI
                        </button>
                    `;
                }
            }
            
            display.style.display = 'block';
        }

        // =========== MODAL PARA VENDA DE IM√ìVEIS ===========
        function showSellRealEstateModal(playerId) {
            const player = gameState.players[playerId];
            const marketCard = gameState.marketEvent;
            
            if (player.assets.realEstate.length === 0) {
                alert("Voc√™ n√£o possui im√≥veis para vender.");
                declineCard();
                return;
            }
            
            let html = '<p>Selecione quais im√≥veis deseja vender:</p>';
            
            player.assets.realEstate.forEach((asset, index) => {
                const saleValue = Math.round(asset.cost * marketCard.modifier);
                const profit = saleValue - asset.cost;
                
                html += `
                    <div class="asset-item">
                        <div class="asset-info">
                            <strong>${asset.name}</strong><br>
                            <small>Valor original: R$ ${asset.cost.toLocaleString()}</small><br>
                            <small>Valor de venda: R$ ${saleValue.toLocaleString()} (${profit > 0 ? '+' : ''}R$ ${profit.toLocaleString()})</small><br>
                            <small>Renda mensal: R$ ${asset.cashflow}</small>
                        </div>
                        <div class="sell-checkbox">
                            <input type="checkbox" id="realEstate${index}" data-index="${index}" data-value="${saleValue}" data-cashflow="${asset.cashflow}">
                            <label for="realEstate${index}">Vender</label>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('sellAssetsContent').innerHTML = html;
            document.getElementById('sellAssetsModal').style.display = 'flex';
        }

        function confirmSellAssets() {
            const player = gameState.players[gameState.currentCard.playerId];
            const checkboxes = document.querySelectorAll('#sellAssetsContent input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert("Selecione pelo menos um im√≥vel para vender.");
                return;
            }
            
            const indicesToRemove = [];
            let totalCash = 0;
            let totalCashflowReduction = 0;
            
            checkboxes.forEach(checkbox => {
                const index = parseInt(checkbox.dataset.index);
                const saleValue = parseInt(checkbox.dataset.value);
                const cashflow = parseInt(checkbox.dataset.cashflow);
                
                indicesToRemove.push({ index, saleValue, cashflow });
            });
            
            indicesToRemove.sort((a, b) => b.index - a.index);
            
            indicesToRemove.forEach(item => {
                const asset = player.assets.realEstate[item.index];
                player.cash += item.saleValue;
                player.passiveIncome -= item.cashflow;
                totalCash += item.saleValue;
                totalCashflowReduction += item.cashflow;
                
                addLog(`üí∞ ${player.name} vendeu ${asset.name} por R$ ${item.saleValue.toLocaleString()}`);
                
                player.assets.realEstate.splice(item.index, 1);
            });
            
            addLog(`üìä Total recebido: R$ ${totalCash.toLocaleString()} | Redu√ß√£o de renda: R$ ${totalCashflowReduction}/m√™s`);
            
            closeModal('sellAssetsModal');
            declineCard();
            updateCurrentPlayerInfo();
        }

        // =========== MODAL PARA VENDA DE A√á√ïES (COM REGRAS ESPECIAIS) ===========
        function showSellStocksModal(playerId) {
            const player = gameState.players[playerId];
            const marketCard = gameState.marketEvent;
            
            if (player.assets.stocks.length === 0) {
                alert("Voc√™ n√£o possui a√ß√µes para vender.");
                declineCard();
                return;
            }
            
            let html = '<p>Selecione quais a√ß√µes deseja vender:</p>';
            
            player.assets.stocks.forEach((asset, index) => {
                const totalCost = asset.shares * asset.costPerShare;
                let saleValue = Math.round(totalCost * marketCard.modifier);
                
                if (asset.name.includes("MYT4U")) {
                    const maxSellableShares = Math.floor(asset.shares * 0.5);
                    const maxSaleValue = Math.round((maxSellableShares * asset.costPerShare) * marketCard.modifier);
                    saleValue = maxSaleValue;
                    html += `<div style="color: #e67e22; font-size: 0.8rem; margin-bottom: 5px;"><i class="fas fa-info-circle"></i> MYT4U: s√≥ pode vender 50% das a√ß√µes por evento</div>`;
                } else if (asset.name.includes("ON2U")) {
                    html += `<div style="color: #e67e22; font-size: 0.8rem; margin-bottom: 5px;"><i class="fas fa-info-circle"></i> ON2U: venda somente permitida em mercado de alta</div>`;
                }
                
                const profit = saleValue - totalCost;
                
                html += `
                    <div class="asset-item">
                        <div class="asset-info">
                            <strong>${asset.name}</strong><br>
                            <small>${asset.shares} a√ß√µes a R$ ${asset.costPerShare}/cada</small><br>
                            <small>Investido: R$ ${totalCost.toLocaleString()}</small><br>
                            <small>Valor de venda: R$ ${saleValue.toLocaleString()} (${profit > 0 ? '+' : ''}R$ ${profit.toLocaleString()})</small><br>
                            ${asset.cashflow > 0 ? `<small>Dividendo: R$ ${asset.cashflow}/m√™s</small>` : ''}
                            ${asset.specialRules ? `<small style="color: #666;">${asset.specialRules}</small>` : ''}
                        </div>
                        <div class="sell-checkbox">
                            <input type="checkbox" id="stocks${index}" data-index="${index}" data-value="${saleValue}" data-cashflow="${asset.cashflow}" data-name="${asset.name}" data-shares="${asset.shares}">
                            <label for="stocks${index}">Vender</label>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('sellStocksContent').innerHTML = html;
            document.getElementById('sellStocksModal').style.display = 'flex';
        }

        function confirmSellStocks() {
            const player = gameState.players[gameState.currentCard.playerId];
            const checkboxes = document.querySelectorAll('#sellStocksContent input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert("Selecione pelo menos uma a√ß√£o para vender.");
                return;
            }
            
            const indicesToRemove = [];
            let totalCash = 0;
            let totalCashflowReduction = 0;
            
            checkboxes.forEach(checkbox => {
                const index = parseInt(checkbox.dataset.index);
                const saleValue = parseInt(checkbox.dataset.value);
                const cashflow = parseInt(checkbox.dataset.cashflow);
                const stockName = checkbox.dataset.name;
                const currentShares = parseInt(checkbox.dataset.shares);
                
                indicesToRemove.push({ index, saleValue, cashflow, stockName, currentShares });
            });
            
            indicesToRemove.sort((a, b) => b.index - a.index);
            
            indicesToRemove.forEach(item => {
                const asset = player.assets.stocks[item.index];
                
                if (item.stockName.includes("MYT4U")) {
                    const sharesToRemove = Math.floor(item.currentShares * 0.5);
                    if (sharesToRemove > 0) {
                        asset.shares -= sharesToRemove;
                        if (asset.shares <= 0) {
                            player.assets.stocks.splice(item.index, 1);
                        }
                    }
                } else {
                    player.assets.stocks.splice(item.index, 1);
                }
                
                player.cash += item.saleValue;
                player.passiveIncome -= item.cashflow;
                totalCash += item.saleValue;
                totalCashflowReduction += item.cashflow;
                
                addLog(`üí∞ ${player.name} vendeu ${item.stockName} por R$ ${item.saleValue.toLocaleString()}`);
            });
            
            addLog(`üìä Total recebido: R$ ${totalCash.toLocaleString()} | Redu√ß√£o de renda: R$ ${totalCashflowReduction}/m√™s`);
            
            closeModal('sellStocksModal');
            declineCard();
            updateCurrentPlayerInfo();
        }

        // =========== EVENTOS DO TABULEIRO ===========
        function payday(playerId) {
            const player = gameState.players[playerId];
            
            // Verificar se est√° demitido
            if (player.isDownsized) {
                player.downsizedRounds++;
                
                // Ap√≥s 2 rodadas, volta a receber sal√°rio
                if (player.downsizedRounds >= 2) {
                    player.isDownsized = false;
                    player.downsizedRounds = 0;
                    addLog(`üéâ ${player.name} voltou ao trabalho! Agora recebe sal√°rio normalmente.`);
                } else {
                    // Demitido: n√£o recebe sal√°rio, s√≥ renda passiva
                    const childExpenses = player.children * player.perChildCost;
                    const totalExpenses = player.expenses + childExpenses;
                    const totalIncome = player.passiveIncome; // Sem sal√°rio
                    
                    let loanPayments = 0;
                    player.loans.forEach(loan => {
                        loanPayments += loan.monthlyPayment;
                    });
                    
                    const netIncome = totalIncome - totalExpenses - loanPayments;
                    player.cash += netIncome;
                    
                    addLog(`‚è∏Ô∏è ${player.name} est√° demitido! Recebeu apenas: Renda Passiva R$ ${player.passiveIncome} - Despesas R$ ${totalExpenses} - Empr√©stimos R$ ${loanPayments} = R$ ${netIncome.toLocaleString()}`);
                    updateCurrentPlayerInfo();
                    return;
                }
            }
            
            const childExpenses = player.children * player.perChildCost;
            const totalExpenses = player.expenses + childExpenses;
            const totalIncome = player.salary + player.passiveIncome;
            
            let loanPayments = 0;
            player.loans.forEach(loan => {
                loanPayments += loan.monthlyPayment;
            });
            
            const netIncome = totalIncome - totalExpenses - loanPayments;
            player.cash += netIncome;
            
            addLog(`üí∞ ${player.name} recebeu: Sal√°rio R$ ${player.salary} + Renda Passiva R$ ${player.passiveIncome} - Despesas R$ ${totalExpenses} - Empr√©stimos R$ ${loanPayments} = R$ ${netIncome.toLocaleString()}`);
            
            updateCurrentPlayerInfo();
        }

        function haveBaby(playerId) {
            const player = gameState.players[playerId];
            
            if (player.children >= player.maxChildren) {
                addLog(`üë∂ ${player.name} j√° tem o m√°ximo de 3 filhos!`);
                return;
            }
            
            player.children++;
            addLog(`üë∂ ${player.name} teve um beb√™! Total: ${player.children} filho(s) (+R$ ${player.perChildCost}/m√™s cada)`);
            updateCurrentPlayerInfo();
        }

        function charity(playerId) {
            const player = gameState.players[playerId];
            const amount = Math.floor(player.salary * 0.1);
            
            if (player.cash >= amount) {
                player.cash -= amount;
                addLog(`‚ù§Ô∏è ${player.name} doou R$ ${amount.toLocaleString()} para caridade`);
                
                gameState.dice3Enabled = true;
                gameState.charityPlayer = playerId;
                addLog(`üé≤ Pr√≥ximas 3 rodadas, ${player.name} pode rolar 3 dados e usar os 2 maiores!`);
            } else {
                alert(`Dinheiro insuficiente para caridade! Necess√°rio: R$ ${amount.toLocaleString()}`);
            }
            
            updateCurrentPlayerInfo();
        }

        function downsized(playerId) {
            const player = gameState.players[playerId];
            const childExpenses = player.children * player.perChildCost;
            const totalExpenses = player.expenses + childExpenses;
            
            // Verificar se tem neg√≥cio Fast Food (reduz fluxo em 50%)
            player.assets.businesses.forEach(business => {
                if (business.name.includes("Fast Food")) {
                    const reducedCashflow = Math.floor(business.cashflow * 0.5);
                    addLog(`üçî ${player.name} neg√≥cio Fast Food afetado! Fluxo reduzido de R$ ${business.cashflow} para R$ ${reducedCashflow}/m√™s por 2 rodadas`);
                    business.cashflow = reducedCashflow;
                }
            });
            
            // **NOVA REGRA: VERIFICA√á√ÉO DE SALDO E EMPR√âSTIMO AUTOM√ÅTICO**
            if (player.cash >= totalExpenses) {
                // Tem dinheiro suficiente
                player.cash -= totalExpenses;
                addLog(`‚ö†Ô∏è ${player.name} foi demitido! Pagou R$ ${totalExpenses.toLocaleString()} em despesas.`);
            } else {
                // **NOVA REGRA: Dinheiro insuficiente vira empr√©stimo autom√°tico**
                const deficit = totalExpenses - player.cash;
                
                // Zerar o saldo
                player.cash = 0;
                
                // Criar empr√©stimo autom√°tico para o valor que faltou
                const loanAmount = deficit;
                const monthlyPayment = loanAmount * 0.1;
                
                player.loans.push({
                    amount: loanAmount,
                    interestRate: 0.1,
                    monthlyPayment: monthlyPayment,
                    takenAt: Date.now(),
                    reason: "Demiss√£o - D√©ficit autom√°tico"
                });
                
                player.expenses += monthlyPayment;
                
                addLog(`‚ö†Ô∏è ${player.name} foi demitido! Saldo insuficiente: R$ ${(totalExpenses - deficit).toLocaleString()} dispon√≠veis, precisa de R$ ${totalExpenses.toLocaleString()}`);
                addLog(`üè¶ Empr√©stimo autom√°tico gerado: R$ ${loanAmount.toLocaleString()} (pagamento: R$ ${monthlyPayment.toLocaleString()}/m√™s)`);
                addLog(`üí∞ Saldo zerado. D√≠vida total: R$ ${player.loans.reduce((sum, loan) => sum + loan.amount, 0).toLocaleString()}`);
            }
            
            // Marcar jogador como demitido
            player.isDownsized = true;
            player.downsizedRounds = 0;
            
            updateCurrentPlayerInfo();
        }

        // =========== SAIR DA CORRIDA DOS RATOS ===========
        function checkExitRatRace(playerId) {
            const player = gameState.players[playerId];
            const childExpenses = player.children * player.perChildCost;
            const totalExpenses = player.expenses + childExpenses;
            
            if (player.passiveIncome > totalExpenses && player.inRatRace) {
                player.inRatRace = false;
                addLog(`üöÄüéâ ${player.name} SAIU DA CORRIDA DOS RATOS!`);
                addLog(`üí∞ Renda passiva (R$ ${player.passiveIncome}/m√™s) > Despesas (R$ ${totalExpenses}/m√™s)`);
                addLog(`üéØ Agora est√° na VIA R√ÅPIDA (FAST TRACK)!`);
                addLog(`üí≠ Sonho de ${player.name}: ${player.assignedDream}`);
                
                updateBoard();
                updateGameStats();
            }
        }

        // =========== FAST TRACK ===========
        function showFastTrackOpportunity() {
            const player = gameState.players[gameState.currentPlayer];
            const card = fastTrackCards[Math.floor(Math.random() * fastTrackCards.length)];
            gameState.currentCard = { ...card, playerId: player.id, cardType: 'fast' };
            
            const display = document.getElementById('cardDisplay');
            const title = document.getElementById('cardTitle');
            const typeTag = document.getElementById('cardTypeTag');
            const description = document.getElementById('cardDescription');
            const details = document.getElementById('cardDetails');
            const actions = document.getElementById('cardActions');
            
            title.textContent = card.nome;
            typeTag.textContent = 'FAST TRACK';
            typeTag.style.backgroundColor = '#9b59b6';
            description.textContent = card.descricao;
            
            if (card.tipo === 'gasto') {
                details.innerHTML = `
                    <div class="card-detail">
                        <div class="detail-label">Tipo</div>
                        <div class="detail-value">Experi√™ncia / Gasto</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Custo</div>
                        <div class="detail-value" style="color: #e74c3c;">R$ ${card.custo.toLocaleString()}</div>
                    </div>
                `;
                
                actions.innerHTML = `
                    <button class="button ${player.cash >= card.custo ? 'button-danger' : ''}" onclick="fastTrackSpend(${player.id})" ${player.cash < card.custo ? 'disabled' : ''}>
                        <i class="fas fa-check"></i> ${player.cash >= card.custo ? 'GASTAR' : 'DINHEIRO INSUFICIENTE'}
                    </button>
                    <button class="button" onclick="declineCard()">
                        <i class="fas fa-times"></i> RECUSAR
                    </button>
                `;
                
            } else if (card.tipo === 'investimento') {
                details.innerHTML = `
                    <div class="card-detail">
                        <div class="detail-label">Tipo</div>
                        <div class="detail-value">Investimento</div>
                    </div>
                    <div class="card-detail">
                        <div class="detail-label">Entrada</div>
                        <div class="detail-value">R$ ${card.entrada.toLocaleString()}</div>
                    </div>
                    ${card.ccr ? `
                    <div class="card-detail">
                        <div class="detail-label">CCR</div>
                        <div class="detail-value">${card.ccr}%</div>
                    </div>
                    ` : ''}
                    ${card.fluxo ? `
                    <div class="card-detail">
                        <div class="detail-label">Fluxo Mensal</div>
                        <div class="detail-value" style="color: #2ecc71;">+R$ ${card.fluxo.toLocaleString()}</div>
                    </div>
                    ` : ''}
                `;
                
                actions.innerHTML = `
                    <button class="button ${player.cash >= card.entrada ? 'button-success' : ''}" onclick="fastTrackInvest(${player.id})" ${player.cash < card.entrada ? 'disabled' : ''}>
                        <i class="fas fa-check"></i> ${player.cash >= card.entrada ? 'INVESTIR' : 'DINHEIRO INSUFICIENTE'}
                    </button>
                    <button class="button" onclick="declineCard()">
                        <i class="fas fa-times"></i> RECUSAR
                    </button>
                `;
                
            } else if (card.tipo === 'penalidade') {
                if (card.id === 'auditoria') {
                    const amount = Math.floor(player.cash * 0.5);
                    details.innerHTML = `
                        <div class="card-detail">
                            <div class="detail-label">Tipo</div>
                            <div class="detail-value">Penalidade</div>
                        </div>
                        <div class="card-detail">
                            <div class="detail-label">Descri√ß√£o</div>
                            <div class="detail-value">Auditoria Fiscal</div>
                        </div>
                        <div class="card-detail">
                            <div class="detail-label">Valor</div>
                            <div class="detail-value" style="color: #e74c3c;">50% do seu dinheiro: R$ ${amount.toLocaleString()}</div>
                        </div>
                        <div class="card-detail">
                            <div class="detail-label">Regra</div>
                            <div class="detail-value">N√£o pode ser evitada por prote√ß√£o</div>
                        </div>
                    `;
                    
                    actions.innerHTML = `
                        <button class="button button-danger" onclick="fastTrackPenalty(${player.id})">
                            <i class="fas fa-exclamation-triangle"></i> PAGAR
                        </button>
                    `;
                } else if (card.id === 'processo') {
                    details.innerHTML = `
                        <div class="card-detail">
                            <div class="detail-label">Tipo</div>
                            <div class="detail-value">Penalidade</div>
                        </div>
                        <div class="card-detail">
                            <div class="detail-label">Descri√ß√£o</div>
                            <div class="detail-value">Processo Judicial</div>
                        </div>
                        <div class="card-detail">
                            <div class="detail-label">Custo</div>
                            <div class="detail-value" style="color: #e74c3c;">R$ ${card.custo.toLocaleString()}</div>
                        </div>
                    `;
                    
                    actions.innerHTML = `
                        <button class="button ${player.cash >= card.custo ? 'button-danger' : ''}" onclick="fastTrackPenalty(${player.id})" ${player.cash < card.custo ? 'disabled' : ''}>
                            <i class="fas fa-exclamation-triangle"></i> ${player.cash >= card.custo ? 'PAGAR' : 'DINHEIRO INSUFICIENTE'}
                        </button>
                    `;
                }
            }
            
            display.style.display = 'block';
        }

        function fastTrackSpend(playerId) {
            const card = gameState.currentCard;
            const player = gameState.players[playerId];
            
            if (player.cash < card.custo) {
                alert("Dinheiro insuficiente!");
                return;
            }
            
            player.cash -= card.custo;
            
            if (card.nome === player.assignedDream || card.custo >= 100000) {
                player.dreams.push(card.nome);
                addLog(`üèÜ ${player.name} realizou o sonho: ${card.nome} por R$ ${card.custo.toLocaleString()}`);
                
                if (card.nome === player.assignedDream) {
                    declareWinner(playerId);
                }
            } else {
                addLog(`üí∏ ${player.name} gastou R$ ${card.custo.toLocaleString()} em ${card.nome}`);
            }
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
            updateFastTrackSection();
        }

        function fastTrackInvest(playerId) {
            const card = gameState.currentCard;
            const player = gameState.players[playerId];
            
            if (player.cash < card.entrada) {
                alert("Dinheiro insuficiente!");
                return;
            }
            
            player.cash -= card.entrada;
            
            if (card.fluxo) {
                player.passiveIncome += card.fluxo;
                addLog(`‚úÖ ${player.name} investiu R$ ${card.entrada.toLocaleString()} em ${card.nome} (renda: +R$ ${card.fluxo}/m√™s)`);
            } else if (card.ccr) {
                const monthlyReturn = (card.entrada * (card.ccr / 100)) / 12;
                player.passiveIncome += monthlyReturn;
                addLog(`‚úÖ ${player.name} investiu R$ ${card.entrada.toLocaleString()} em ${card.nome} (CCR: ${card.ccr}%, renda: +R$ ${monthlyReturn.toLocaleString()}/m√™s)`);
            }
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
            updateFastTrackSection();
        }

        function fastTrackPenalty(playerId) {
            const card = gameState.currentCard;
            const player = gameState.players[playerId];
            
            if (card.id === 'auditoria') {
                const amount = Math.floor(player.cash * 0.5);
                player.cash -= amount;
                addLog(`‚ö†Ô∏è ${player.name} pagou R$ ${amount.toLocaleString()} em auditoria fiscal`);
            } else if (card.id === 'processo') {
                if (player.cash < card.custo) {
                    alert("Dinheiro insuficiente para pagar o processo!");
                    return;
                }
                player.cash -= card.custo;
                addLog(`‚ö†Ô∏è ${player.name} pagou R$ ${card.custo.toLocaleString()} em processo judicial`);
            }
            
            document.getElementById('cardDisplay').style.display = 'none';
            updateCurrentPlayerInfo();
        }

        // =========== VIT√ìRIA ===========
        function declareWinner(playerId) {
            const player = gameState.players[playerId];
            gameState.gameActive = false;
            
            const winnerDiv = document.getElementById('winnerMessage');
            winnerDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, #9b59b6, #8e44ad); 
                           color: white; padding: 20px; border-radius: 10px; 
                           text-align: center; margin-top: 15px; font-weight: bold; font-size: 1.2rem;">
                    üèÜüéâ ${player.name} VENCEU O JOGO! üéâüèÜ<br>
                    <small>Realizou o sonho: ${player.assignedDream}</small>
                </div>
            `;
            
            addLog(`üèÜüéâ ${player.name} VENCEU O JOGO NO FAST TRACK! PARAB√âNS!`);
            addLog(`üéØ Sonho realizado: ${player.assignedDream}`);
            
            document.getElementById('rollDiceBtn').disabled = true;
            document.getElementById('endTurnBtn').disabled = true;
        }

        // =========== TURNO ===========
        function endTurn() {
            document.getElementById('dice3').style.display = 'none';
            
            gameState.currentPlayer = gameState.currentPlayer % gameState.totalPlayers + 1;
            
            if (gameState.currentPlayer === 1) {
                gameState.currentRound++;
                addLog(`üìÖ RODADA ${gameState.currentRound} INICIADA`);
                updateGameStats();
            }
            
            document.getElementById('endTurnBtn').disabled = true;
            document.getElementById('rollDiceBtn').disabled = false;
            
            document.getElementById('cardDisplay').style.display = 'none';
            
            updateCurrentPlayerInfo();
            updateProtectionButton();
            
            const playerName = gameState.players[gameState.currentPlayer].name;
            addLog(`üîÑ Vez de: ${playerName}`);
            
            if (!gameState.players[gameState.currentPlayer].inRatRace) {
                setTimeout(() => {
                    showFastTrackOpportunity();
                }, 500);
            }
        }

        // =========== ATIVOS ===========
        function showAssets() {
            const player = gameState.players[gameState.currentPlayer];
            let html = `<h3 style="color: var(--secondary); margin-bottom: 15px;">${player.name} - ${player.profession}</h3>`;
            
            const childExpenses = player.children * player.perChildCost;
            const totalExpenses = player.expenses + childExpenses;
            
            let totalLoans = 0;
            let totalLoanPayments = 0;
            player.loans.forEach(loan => {
                totalLoans += loan.amount;
                totalLoanPayments += loan.monthlyPayment;
            });
            
            html += `
                <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">Sal√°rio</div>
                            <div style="font-weight: bold;">R$ ${player.salary.toLocaleString()}/m√™s</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">Despesas Fixas</div>
                            <div style="font-weight: bold; color: #e74c3c;">R$ ${player.expenses.toLocaleString()}/m√™s</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">Renda Passiva</div>
                            <div style="font-weight: bold; color: #2ecc71;">R$ ${player.passiveIncome.toLocaleString()}/m√™s</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">Filhos</div>
                            <div style="font-weight: bold;">${player.children} (R$ ${childExpenses}/m√™s)</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">Despesas Totais</div>
                            <div style="font-weight: bold; color: #e74c3c;">R$ ${totalExpenses.toLocaleString()}/m√™s</div>
                        </div>
                        <div>
                            <div style="color: #666; font-size: 0.9rem;">Fluxo de Caixa</div>
                            <div style="font-weight: bold; color: ${player.salary + player.passiveIncome - totalExpenses - totalLoanPayments >= 0 ? '#2ecc71' : '#e74c3c'}">
                                R$ ${(player.salary + player.passiveIncome - totalExpenses - totalLoanPayments).toLocaleString()}/m√™s
                            </div>
                        </div>
                        ${totalLoans > 0 ? `
                        <div style="grid-column: 1 / -1; background: #e74c3c10; padding: 10px; border-radius: 5px;">
                            <div style="color: #666; font-size: 0.9rem;">Empr√©stimos</div>
                            <div style="font-weight: bold; color: #e74c3c;">
                                Total: R$ ${totalLoans.toLocaleString()} | Pagamentos: R$ ${totalLoanPayments.toLocaleString()}/m√™s
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            if (player.assets.stocks.length > 0) {
                html += `<h4 style="color: #3498db; margin-top: 15px; border-bottom: 2px solid #3498db; padding-bottom: 5px;">A√á√ïES E FUNDOS</h4>`;
                player.assets.stocks.forEach((stock, index) => {
                    const totalCost = stock.shares * stock.costPerShare;
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                            <div><strong>${stock.name}</strong></div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>${stock.shares} a√ß√µes a R$ ${stock.costPerShare}</span>
                                <span>Investido: R$ ${totalCost.toLocaleString()}</span>
                                ${stock.cashflow > 0 ? `<span style="color: #2ecc71;">Renda: +R$ ${stock.cashflow}/m√™s</span>` : ''}
                            </div>
                            ${stock.specialRules ? `<div style="color: #e67e22; font-size: 0.8rem; margin-top: 3px;"><i class="fas fa-exclamation-triangle"></i> ${stock.specialRules}</div>` : ''}
                            ${stock.roi ? `<div style="color: #666; font-size: 0.8rem; margin-top: 3px;">${stock.roi}</div>` : ''}
                        </div>
                    `;
                });
            }
            
            if (player.assets.realEstate.length > 0) {
                html += `<h4 style="color: #e67e22; margin-top: 15px; border-bottom: 2px solid #e67e22; padding-bottom: 5px;">IM√ìVEIS</h4>`;
                player.assets.realEstate.forEach((property, index) => {
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                            <div><strong>${property.name}</strong></div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Valor: R$ ${property.cost.toLocaleString()}</span>
                                <span>Entrada: R$ ${property.downPayment.toLocaleString()}</span>
                                <span style="color: #2ecc71;">Renda: +R$ ${property.cashflow}/m√™s</span>
                            </div>
                            ${property.mortgage > 0 ? `<div style="color: #666; font-size: 0.8rem;">Financiamento: R$ ${property.mortgage.toLocaleString()}</div>` : ''}
                            ${property.roi ? `<div style="color: #666; font-size: 0.8rem; margin-top: 3px;">${property.roi}</div>` : ''}
                        </div>
                    `;
                });
            }
            
            if (player.assets.businesses.length > 0) {
                html += `<h4 style="color: #9b59b6; margin-top: 15px; border-bottom: 2px solid #9b59b6; padding-bottom: 5px;">NEG√ìCIOS</h4>`;
                player.assets.businesses.forEach((business, index) => {
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                            <div><strong>${business.name}</strong></div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Valor: R$ ${business.cost.toLocaleString()}</span>
                                <span>Entrada: R$ ${business.downPayment.toLocaleString()}</span>
                                <span style="color: #2ecc71;">Renda: +R$ ${business.cashflow}/m√™s</span>
                            </div>
                            ${business.roi ? `<div style="color: #666; font-size: 0.8rem; margin-top: 3px;">${business.roi}</div>` : ''}
                        </div>
                    `;
                });
            }
            
            if (player.assets.bonds.length > 0) {
                html += `<h4 style="color: #2ecc71; margin-top: 15px; border-bottom: 2px solid #2ecc71; padding-bottom: 5px;">T√çTULOS E FUNDOS</h4>`;
                player.assets.bonds.forEach((bond, index) => {
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                            <div><strong>${bond.name}</strong></div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span>Investido: R$ ${bond.cost.toLocaleString()}</span>
                                <span style="color: #2ecc71;">Renda: +R$ ${bond.cashflow}/m√™s</span>
                            </div>
                            ${bond.roi ? `<div style="color: #666; font-size: 0.8rem; margin-top: 3px;">${bond.roi}</div>` : ''}
                        </div>
                    `;
                });
            }
            
            if (player.assets.protection) {
                html += `<h4 style="color: #27ae60; margin-top: 15px; border-bottom: 2px solid #27ae60; padding-bottom: 5px;">PROTE√á√ÉO FINANCEIRA</h4>`;
                html += `
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                        <div><strong>${player.assets.protection.name}</strong></div>
                        <div style="color: #666; margin-top: 5px;">${player.assets.protection.description}</div>
                        <div style="color: #27ae60; margin-top: 5px;"><i class="fas fa-shield-alt"></i> Pronta para uso</div>
                    </div>
                `;
            }
            
            if (player.assets.stocks.length === 0 && player.assets.realEstate.length === 0 && 
                player.assets.businesses.length === 0 && player.assets.bonds.length === 0 && !player.assets.protection) {
                html += '<p>Nenhum ativo adquirido.</p>';
            }
            
            html += `<h4 style="color: #f39c12; margin-top: 20px; border-bottom: 2px solid #f39c12; padding-bottom: 5px;">SONHO</h4>`;
            html += `<p><strong>${player.assignedDream}</strong></p>`;
            
            if (player.dreams.length > 0) {
                html += `<h4 style="color: #f39c12; margin-top: 20px; border-bottom: 2px solid #f39c12; padding-bottom: 5px;">SONHOS REALIZADOS</h4>`;
                player.dreams.forEach(dream => {
                    html += `<p>‚≠ê ${dream}</p>`;
                });
            }
            
            document.getElementById('assetsContent').innerHTML = html;
            document.getElementById('assetsTitle').textContent = `${player.name} - Situa√ß√£o Financeira`;
            document.getElementById('assetsModal').style.display = 'flex';
        }

        // =========== FUN√á√ïES AUXILIARES ===========
        function addLog(message) {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            log.prepend(entry);
            
            if (log.children.length > 30) {
                log.removeChild(log.lastChild);
            }
        }

        function clearLog() {
            document.getElementById('gameLog').innerHTML = '<div class="log-entry">Hist√≥rico limpo</div>';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function declineCard() {
            const player = gameState.players[gameState.currentCard.playerId];
            addLog(`‚ùå ${player.name} recusou a oferta`);
            document.getElementById('cardDisplay').style.display = 'none';
        }

        // =========== INICIALIZAR ===========
        document.addEventListener('DOMContentLoaded', initializeGame);
    </script>
</body>
</html>